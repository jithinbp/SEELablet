<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>interface &mdash; vLabtool Programer&#39;s Manual</title>
    
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="top" title="vLabtool Programer&#39;s Manual" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">vLabtool Quick ref</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for interface</h1><div class="highlight"><pre>
<span class="c"># interface - software stack to support the vLabtool-v0.</span>
<span class="c">#</span>
<span class="c"># Copyright (C) 2015 by Jithin B.P. &lt;jithinbp@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">commands_proto</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">packet_handler</span>

<span class="kn">import</span> <span class="nn">I2C_class</span><span class="o">,</span><span class="nn">SPI_class</span><span class="o">,</span><span class="nn">NRF24L01_class</span><span class="o">,</span><span class="nn">MCP4728_class</span><span class="o">,</span><span class="nn">NRF_NODE</span>

<span class="kn">from</span> <span class="nn">achan</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">digital_channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">serial</span><span class="o">,</span><span class="nn">string</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>


<div class="viewcode-block" id="connect"><a class="viewcode-back" href="../interface.html#interface.connect">[docs]</a><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If vLabtool hardware is found, returns an instance of &#39;Interface&#39;, else returns None.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Interface</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Err&#39;</span>
        <span class="k">return</span> <span class="bp">None</span>
    


</div>
<div class="viewcode-block" id="Interface"><a class="viewcode-back" href="../interface.html#interface.Interface">[docs]</a><span class="k">class</span> <span class="nc">Interface</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Communications library.**</span>

<span class="sd">    This class contains methods that can be used to interact with the vLabtool</span>

<span class="sd">    Initialization does the following</span>
<span class="sd">    </span>
<span class="sd">    * connects to tty device</span>
<span class="sd">    * loads calibration values.</span>

<span class="sd">    .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">    +----------+-----------------------------------------------------------------+</span>
<span class="sd">    |Arguments |Description                                                      |</span>
<span class="sd">    +==========+=================================================================+</span>
<span class="sd">    |timeout   | serial port read timeout. default = 1s                          |</span>
<span class="sd">    +----------+-----------------------------------------------------------------+</span>

<span class="sd">    &gt;&gt;&gt; from v0 import interface</span>
<span class="sd">    &gt;&gt;&gt; I = interface.connect()</span>
<span class="sd">    &gt;&gt;&gt; print I</span>
<span class="sd">    &lt;interface.Interface instance at 0xb6c0cac&gt;</span>
<span class="sd">    </span>

<span class="sd">    Once you have instantiated this class,  its various methods will allow access to all the features built</span>
<span class="sd">    into the device.</span>


<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialArgs</span> <span class="o">=</span> <span class="n">kwargs</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ADC_SHIFTS_LOCATION1</span><span class="o">=</span><span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ADC_SHIFTS_LOCATION2</span><span class="o">=</span><span class="mi">12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ADC_POLYNOMIALS_LOCATION</span><span class="o">=</span><span class="mi">13</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_POLYNOMIALS_LOCATION</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS1A</span><span class="o">=</span><span class="mi">14</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS1B</span><span class="o">=</span><span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS2A</span><span class="o">=</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS2B</span><span class="o">=</span><span class="mi">17</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS3A</span><span class="o">=</span><span class="mi">18</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS3B</span><span class="o">=</span><span class="mi">19</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">BAUD</span> <span class="o">=</span> <span class="mi">1000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timebase</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triggerLevel</span><span class="o">=</span><span class="mi">550</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triggerChannel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_count</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;data_splitting&#39;</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>


        <span class="c">#--------------------------Initialize communication handler, and subclasses-----------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__runInitSequence__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__runInitSequence__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">packet_handler</span><span class="o">.</span><span class="n">Handler</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">connected</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Check hardware connections. Not connected&#39;</span>
            <span class="k">return</span>          
        <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span> <span class="o">=</span> <span class="n">MCP4728_class</span><span class="o">.</span><span class="n">MCP4728</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span><span class="mf">3.3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allAnalogChannels</span><span class="o">=</span><span class="n">allAnalogChannels</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">allAnalogChannels</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">=</span><span class="n">analogInputSource</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        

        <span class="c">#-------Check for calibration data. And process them if found---------------</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;load_calibration&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">polynomials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADC_POLYNOMIALS_LOCATION</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span>
            <span class="n">polyDict</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">if</span> <span class="n">polynomials</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;VLABTOOL&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span><span class="s">&#39;ADC calibration found...&#39;</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">struct</span>
                <span class="n">adc_shifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADC_SHIFTS_LOCATION1</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADC_SHIFTS_LOCATION2</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span>
                <span class="n">adc_shifts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">adc_shifts</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span><span class="s">&#39;ADC INL correction table loaded.&#39;</span><span class="p">)</span>
                <span class="n">inl_slope_intercept</span> <span class="o">=</span> <span class="n">polynomials</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;STOP&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">dac_slope_intercept</span> <span class="o">=</span> <span class="n">polynomials</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;STOP&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">slopes_offsets</span><span class="o">=</span><span class="n">polynomials</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;STOP&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">slopes_offsets</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&gt;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">S</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&lt;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">cals</span><span class="o">=</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">polyDict</span><span class="p">[</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cals</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">):</span>
                        <span class="n">poly</span><span class="o">=</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;4f&#39;</span><span class="p">,</span><span class="n">cals</span><span class="p">[</span><span class="n">b</span><span class="o">*</span><span class="mi">16</span><span class="p">:(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">16</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span><span class="n">poly</span><span class="p">)</span>
                        <span class="n">polyDict</span><span class="p">[</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dac_slope_intercept</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&gt;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">S</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&lt;&#39;</span><span class="p">)</span>
                    <span class="n">NAME</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="p">,</span><span class="n">NAME</span><span class="p">)</span>
                    <span class="n">fits</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;6f&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">slope</span><span class="o">=</span><span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="n">intercept</span><span class="o">=</span><span class="n">fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">fitvals</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">NAME</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PVS1&#39;</span><span class="p">,</span><span class="s">&#39;PVS2&#39;</span><span class="p">,</span><span class="s">&#39;PVS3&#39;</span><span class="p">]:</span>
                        <span class="n">DACX</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">CHANS</span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">CHANS</span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">4096</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">NAME</span><span class="o">==</span><span class="s">&#39;PVS1&#39;</span><span class="p">:</span><span class="n">OFF</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS1A</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS1B</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">NAME</span><span class="o">==</span><span class="s">&#39;PVS2&#39;</span><span class="p">:</span><span class="n">OFF</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS2A</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS2B</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">NAME</span><span class="o">==</span><span class="s">&#39;PVS3&#39;</span><span class="p">:</span><span class="n">OFF</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS3A</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAC_SHIFTS_PVS3B</span><span class="p">,</span><span class="mi">2048</span><span class="p">)</span>

                        <span class="n">OFF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">OFF</span><span class="p">])</span>
                        <span class="n">fitfn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">fitvals</span><span class="p">)</span>
                        <span class="n">YDATA</span> <span class="o">=</span> <span class="n">fitfn</span><span class="p">(</span><span class="n">DACX</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">OFF</span><span class="o">*</span><span class="n">slope</span><span class="o">+</span><span class="n">intercept</span><span class="p">)</span>
                        <span class="n">LOOKBEHIND</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span><span class="n">LOOKAHEAD</span><span class="o">=</span><span class="mi">100</span>                      
                        <span class="n">OFF</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">YDATA</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">LOOKBEHIND</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="mi">4095</span><span class="p">,</span><span class="n">B</span><span class="o">+</span><span class="n">LOOKAHEAD</span><span class="p">)]</span><span class="o">-</span><span class="n">DACX</span><span class="p">[</span><span class="n">B</span><span class="p">])</span> <span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">LOOKBEHIND</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4096</span><span class="p">)])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">load_calibration</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span><span class="n">OFF</span><span class="p">)</span>
                
                <span class="n">inl_slope_intercept</span><span class="o">=</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;2f&#39;</span><span class="p">,</span><span class="n">inl_slope_intercept</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">loadCalibrationTable</span><span class="p">(</span><span class="n">adc_shifts</span><span class="p">,</span><span class="n">inl_slope_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">inl_slope_intercept</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">polyDict</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">loadPolynomials</span><span class="p">(</span><span class="n">polyDict</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">calibrationReady</span><span class="o">=</span><span class="bp">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">regenerateCalibration</span><span class="p">()</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="n">polynomials</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&gt;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                
        
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channel_names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="s">&#39;ID2&#39;</span><span class="p">,</span><span class="s">&#39;ID3&#39;</span><span class="p">,</span><span class="s">&#39;ID4&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;CH1&#39;</span><span class="p">,</span><span class="s">&#39;Fin&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allDigitalChannels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="s">&#39;ID2&#39;</span><span class="p">,</span><span class="s">&#39;ID3&#39;</span><span class="p">,</span><span class="s">&#39;ID4&#39;</span><span class="p">,</span><span class="s">&#39;Fin&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="o">=</span><span class="p">[</span><span class="n">digital_channel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        <span class="c">#This array of four instances of digital_channel is used to store data retrieved from the</span>
        <span class="c">#logic analyzer section of the device.  It also contains methods to generate plottable data</span>
        <span class="c">#from the original timestamp arrays.</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="o">=</span><span class="p">[</span><span class="n">analogAcquisitionChannel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;CH1&#39;</span><span class="p">,</span><span class="s">&#39;CH2&#39;</span><span class="p">,</span><span class="s">&#39;CH3&#39;</span><span class="p">,</span><span class="s">&#39;MIC&#39;</span><span class="p">]]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span> <span class="o">=</span> <span class="n">I2C_class</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="c">#self.I2C.pullSCLLow(5000)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">SPI</span> <span class="o">=</span> <span class="n">SPI_class</span><span class="o">.</span><span class="n">SPI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">SPI</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NRF</span> <span class="o">=</span> <span class="n">NRF24L01_class</span><span class="o">.</span><span class="n">NRF24L01</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;CH1&#39;</span><span class="p">,</span><span class="s">&#39;CH2&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_gain</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SOCKET_CAPACITANCE</span> <span class="o">=</span> <span class="mf">42e-12</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__print__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">a</span><span class="p">,</span>
            <span class="k">print</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;closing port&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="Interface.get_version"><a class="viewcode-back" href="../interface.html#interface.Interface.get_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the version string of the device</span>
<span class="sd">        format: LTS-......</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">get_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="p">)</span>
    </div>
    <span class="k">def</span> <span class="nf">getRadioLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NRF</span><span class="o">.</span><span class="n">get_nodelist</span><span class="p">()</span>

<div class="viewcode-block" id="Interface.newRadioLink"><a class="viewcode-back" href="../interface.html#interface.Interface.newRadioLink">[docs]</a>    <span class="k">def</span> <span class="nf">newRadioLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>

<span class="sd">        ============== ==============================================================================</span>
<span class="sd">        **Arguments**  Description   </span>
<span class="sd">        ============== ==============================================================================</span>
<span class="sd">        \*\*Kwargs     Keyword Arguments </span>
<span class="sd">        address        Address of the node. a 24 bit number. Printed on the nodes.\n</span>
<span class="sd">                       can also be retrieved using :py:meth:`~NRF24L01_class.NRF24L01.get_nodelist`</span>
<span class="sd">        ============== ==============================================================================</span>


<span class="sd">        :return: :py:meth:`~NRF_NODE.RadioLink`</span>

<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">NRF_NODE</span><span class="o">.</span><span class="n">RadioLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NRF</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="c">#-------------------------------------------------------------------------------------------------------------------#</span>

    <span class="c">#|================================================ANALOG SECTION====================================================|</span>
    <span class="c">#|This section has commands related to analog measurement and control. These include the oscilloscope routines,     |</span>
    <span class="c">#|voltmeters, ammeters, and Programmable voltage sources.                               |</span>
    <span class="c">#-------------------------------------------------------------------------------------------------------------------#</span>
</div>
<div class="viewcode-block" id="Interface.reconnect"><a class="viewcode-back" href="../interface.html#interface.Interface.reconnect">[docs]</a>    <span class="k">def</span> <span class="nf">reconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Attempts to reconnect to the device in case of a commmunication error or accidental disconnect.</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">reconnect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Interface.capture1"><a class="viewcode-back" href="../interface.html#interface.Interface.capture1">[docs]</a>    <span class="k">def</span> <span class="nf">capture1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocking call that fetches an oscilloscope trace from the specified input channel</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        ch              Channel to select as input. [&#39;CH1&#39;..&#39;CH3&#39;,&#39;SEN&#39;]</span>
<span class="sd">        ns              Number of samples to fetch. Maximum 10000</span>
<span class="sd">        tg              Timegap between samples in microseconds</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        .. figure:: ../images/capture1.png</span>
<span class="sd">            :width: 11cm</span>
<span class="sd">            :align: center</span>
<span class="sd">            :alt: alternate text</span>
<span class="sd">            :figclass: align-center</span>
<span class="sd">            </span>
<span class="sd">            A sine wave captured and plotted.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pylab import *</span>
<span class="sd">        &gt;&gt;&gt; from v0 import interface</span>
<span class="sd">        &gt;&gt;&gt; I=interface.connect()</span>
<span class="sd">        &gt;&gt;&gt; x,y = I.capture1(&#39;CH1&#39;,3200,1)</span>
<span class="sd">        &gt;&gt;&gt; plot(x,y)</span>
<span class="sd">        &gt;&gt;&gt; show()</span>
<span class="sd">                </span>
<span class="sd">        </span>
<span class="sd">        :return: Arrays X(timestamps),Y(Corresponding Voltage values)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_fullspeed</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.capture2"><a class="viewcode-back" href="../interface.html#interface.Interface.capture2">[docs]</a>    <span class="k">def</span> <span class="nf">capture2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocking call that fetches oscilloscope traces from CH1,CH2</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        ns              Number of samples to fetch. Maximum 5000</span>
<span class="sd">        tg              Timegap between samples in microseconds</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        .. figure:: ../images/capture2.png</span>
<span class="sd">            :width: 11cm</span>
<span class="sd">            :align: center</span>
<span class="sd">            :alt: alternate text</span>
<span class="sd">            :figclass: align-center</span>
<span class="sd">            </span>
<span class="sd">            Two sine waves captured and plotted.</span>

<span class="sd">        Example </span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; from pylab import *</span>
<span class="sd">        &gt;&gt;&gt; from Labtools import interface</span>
<span class="sd">        &gt;&gt;&gt; I=interface.Interface()</span>
<span class="sd">        &gt;&gt;&gt; x,y1,y2 = I.capture2(1600,1.25)</span>
<span class="sd">        &gt;&gt;&gt; plot(x,y1)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y2)              </span>
<span class="sd">        &gt;&gt;&gt; show()              </span>
<span class="sd">        </span>
<span class="sd">        :return: Arrays X(timestamps),Y1(Voltage at CH1),Y2(Voltage at CH2)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture_traces</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">+.</span><span class="mo">01</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscilloscope_progress</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y2</span>       
</div>
<div class="viewcode-block" id="Interface.capture4"><a class="viewcode-back" href="../interface.html#interface.Interface.capture4">[docs]</a>    <span class="k">def</span> <span class="nf">capture4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocking call that fetches oscilloscope traces from CH1,CH2,CH3,CH4</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        ns              Number of samples to fetch. Maximum 2500</span>
<span class="sd">        tg              Timegap between samples in microseconds. Minimum 1.75uS</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        .. figure:: ../images/capture4.png</span>
<span class="sd">            :width: 11cm</span>
<span class="sd">            :align: center</span>
<span class="sd">            :alt: alternate text</span>
<span class="sd">            :figclass: align-center</span>
<span class="sd">            </span>
<span class="sd">            Four traces captured and plotted.</span>
<span class="sd">    </span>
<span class="sd">        Example</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; from pylab import *</span>
<span class="sd">        &gt;&gt;&gt; I=interface.Interface()</span>
<span class="sd">        &gt;&gt;&gt; x,y1,y2,y3,y4 = I.capture4(800,1.75)</span>
<span class="sd">        &gt;&gt;&gt; plot(x,y1)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y2)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y3)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y4)              </span>
<span class="sd">        &gt;&gt;&gt; show()              </span>
<span class="sd">        </span>
<span class="sd">        :return: Arrays X(timestamps),Y1(Voltage at CH1),Y2(Voltage at CH2),Y3(Voltage at CH3),Y4(Voltage at CH4)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture_traces</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">tg</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">+.</span><span class="mo">01</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oscilloscope_progress</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="n">y4</span>     


</div>
<div class="viewcode-block" id="Interface.capture_multiple"><a class="viewcode-back" href="../interface.html#interface.Interface.capture_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">capture_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocking call that fetches oscilloscope traces from a set of specified channels</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        samples         Number of samples to fetch. Maximum 10000/(total specified channels)</span>
<span class="sd">        tg              Timegap between samples in microseconds.</span>
<span class="sd">        \*args          channel names</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">    </span>
<span class="sd">        Example</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; from pylab import *</span>
<span class="sd">        &gt;&gt;&gt; I=interface.Interface()</span>
<span class="sd">        &gt;&gt;&gt; x,y1,y2,y3,y4 = I.capture_multiple(800,1.75,&#39;CH1&#39;,&#39;CH2&#39;,&#39;MIC&#39;,&#39;SEN&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plot(x,y1)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y2)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y3)              </span>
<span class="sd">        &gt;&gt;&gt; plot(x,y4)              </span>
<span class="sd">        &gt;&gt;&gt; show()              </span>
<span class="sd">        </span>
<span class="sd">        :return: Arrays X(timestamps),Y1,Y2 ...</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;please specify channels to record&#39;</span>
            <span class="k">return</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>  <span class="c"># Round off the timescale to 1/8uS units</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tg</span><span class="o">&lt;</span><span class="mf">1.5</span><span class="p">):</span><span class="n">tg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
        <span class="n">total_chans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">total_samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">*</span><span class="n">total_chans</span>
        <span class="k">if</span><span class="p">(</span><span class="n">total_samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Sample limit exceeded. 10,000 total&#39;</span>
            <span class="n">total_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="n">total_chans</span>

        <span class="n">CHANNEL_SELECTION</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span><span class="o">.</span><span class="n">CHOSA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="n">chan</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
            <span class="n">CHANNEL_SELECTION</span><span class="o">|=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;selection&#39;</span><span class="p">,</span><span class="n">CHANNEL_SELECTION</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span><span class="nb">hex</span><span class="p">(</span><span class="n">CHANNEL_SELECTION</span><span class="o">|</span><span class="p">((</span><span class="n">total_chans</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_MULTIPLE</span><span class="p">)</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">CHANNEL_SELECTION</span><span class="o">|</span><span class="p">((</span><span class="n">total_chans</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">total_samples</span><span class="p">)</span>           <span class="c">#total number of samples to record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>        <span class="c">#Timegap between samples.  8MHz timer clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;wait&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">*</span><span class="n">total_samples</span><span class="o">*</span><span class="n">tg</span><span class="o">+.</span><span class="mo">01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;done&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_samples</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#channel number . starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span><span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>        <span class="c">#reading int by int sometimes causes a communication error. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">total_samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#channel number starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">total_samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">total_samples</span><span class="o">-</span><span class="n">total_samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">total_samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">))</span>       <span class="c">#reading int by int may cause packets to be dropped. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_samples</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>
        <span class="c">#self.achans[channel_number-1].yaxis = self.achans[channel_number-1].fix_value(self.buff[:samples])</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tg</span><span class="o">*</span><span class="p">(</span><span class="n">samples</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_chans</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">total_samples</span><span class="p">][::</span><span class="n">total_chans</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="Interface.capture_fullspeed"><a class="viewcode-back" href="../interface.html#interface.Interface.capture_fullspeed">[docs]</a>    <span class="k">def</span> <span class="nf">capture_fullspeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chan</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocking call that fetches oscilloscope traces from a single oscilloscope channel at a maximum speed of 2MSPS</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        chan                channel name &#39;CH1&#39; / &#39;CH2&#39; ... &#39;SEN&#39;</span>
<span class="sd">        samples             Number of samples to fetch. Maximum 10000/(total specified channels)</span>
<span class="sd">        tg                  Timegap between samples in microseconds. minimum 0.5uS</span>
<span class="sd">        \*args              specify if SQR1 must be toggled right before capturing. &#39;SET_LOW&#39; will set it to 0V,</span>
<span class="sd">                            &#39;SET_HIGH&#39; will set it to 5V.  if no arguments are specified, a regular capture will </span>
<span class="sd">                            be executed.</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">    </span>
<span class="sd">        Example</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; from pylab import *</span>
<span class="sd">        &gt;&gt;&gt; I=interface.Interface()</span>
<span class="sd">        &gt;&gt;&gt; x,y = I.capture_fullspeed(&#39;CH1&#39;,2000,1)</span>
<span class="sd">        &gt;&gt;&gt; plot(x,y)               </span>
<span class="sd">        &gt;&gt;&gt; show()              </span>
<span class="sd">        </span>
<span class="sd">        :return: timestamp array ,voltage_value array</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>  <span class="c"># Round off the timescale to 1/8uS units</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tg</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">):</span><span class="n">tg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
        <span class="k">if</span><span class="p">(</span><span class="n">samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Sample limit exceeded. 10,000 max&#39;</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span>

        <span class="n">CHOSA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span><span class="o">.</span><span class="n">CHOSA</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;SET_LOW&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_LO_CAPTURE</span><span class="p">)</span>     
        <span class="k">elif</span> <span class="s">&#39;SET_HIGH&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_HI_CAPTURE</span><span class="p">)</span>     
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_DMASPEED</span><span class="p">)</span>       
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CHOSA</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>         <span class="c">#total number of samples to record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>       <span class="c">#Timegap between samples.  8MHz timer clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;wait&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">*</span><span class="n">samples</span><span class="o">*</span><span class="n">tg</span><span class="o">+.</span><span class="mo">01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__print__</span><span class="p">(</span> <span class="s">&#39;done&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__retrieveBufferData__</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__retrieveBufferData__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chan</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#channel number . starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span><span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>        <span class="c">#reading int by int sometimes causes a communication error. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#channel number starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="o">-</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">))</span>         <span class="c">#reading int by int may cause packets to be dropped. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>
        <span class="c">#self.achans[channel_number-1].yaxis = self.achans[channel_number-1].fix_value(self.buff[:samples])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tg</span><span class="o">*</span><span class="p">(</span><span class="n">samples</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">samples</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span><span class="o">.</span><span class="n">calPoly10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[:</span><span class="n">samples</span><span class="p">])</span>



<div class="viewcode-block" id="Interface.capture_traces"><a class="viewcode-back" href="../interface.html#interface.Interface.capture_traces">[docs]</a>    <span class="k">def</span> <span class="nf">capture_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="n">channel_one_input</span><span class="o">=</span><span class="s">&#39;CH1&#39;</span><span class="p">,</span><span class="n">CH123SA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instruct the ADC to start sampling. use fetch_trace to retrieve the data</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        =================== ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        =================== ============================================================================================</span>
<span class="sd">        num                 Channels to acquire. 1/2/4</span>
<span class="sd">        samples             Total points to store per channel. Maximum 3200 total.</span>
<span class="sd">        tg                  Timegap between two successive samples (in uSec)</span>
<span class="sd">        channel_one_input   map channel 1 to &#39;CH1&#39; ... &#39;CH9&#39;</span>
<span class="sd">        \*\*kwargs        </span>
<span class="sd">        </span>
<span class="sd">        \*trigger           Whether or not to trigger the oscilloscope based on the voltage level set by :func:`configure_trigger`</span>
<span class="sd">        =================== ============================================================================================</span>


<span class="sd">        see :ref:`capture_video`</span>
<span class="sd">    </span>
<span class="sd">        .. _adc_example:</span>

<span class="sd">            .. figure:: ../images/transient.png</span>
<span class="sd">                :width: 11cm</span>
<span class="sd">                :align: center</span>
<span class="sd">                :alt: alternate text</span>
<span class="sd">                :figclass: align-center</span>
<span class="sd">            </span>
<span class="sd">                Transient response of an Inductor and Capacitor in series</span>

<span class="sd">            The following example demonstrates how to use this function to record active events.</span>

<span class="sd">                * Connect a capacitor and an Inductor in series.</span>
<span class="sd">                * Connect CH1 to the spare leg of the inductor. Also Connect OD1 to this point</span>
<span class="sd">                * Connect CH2 to the junction between the capacitor and the inductor</span>
<span class="sd">                * connect the spare leg of the capacitor to GND( ground )</span>
<span class="sd">                * set OD1 initially high using set_state(OD1=1)</span>

<span class="sd">            ::</span>

<span class="sd">                &gt;&gt;&gt; I.set_state(OD1=1)  #Turn on OD1</span>
<span class="sd">                #Arbitrary delay to wait for stabilization</span>
<span class="sd">                &gt;&gt;&gt; time.sleep(0.5)                </span>
<span class="sd">                #Start acquiring data (2 channels,800 samples, 2microsecond intervals)</span>
<span class="sd">                &gt;&gt;&gt; I.capture_traces(2,800,2,trigger=False)</span>
<span class="sd">                #Turn off OD1. This must occur immediately after the previous line was executed.</span>
<span class="sd">                &gt;&gt;&gt; I.set_state(OD1=0)</span>
<span class="sd">                #Minimum interval to wait for completion of data acquisition.</span>
<span class="sd">                #samples*timegap*(convert to Seconds)</span>
<span class="sd">                &gt;&gt;&gt; time.sleep(800*2*1e-6)</span>
<span class="sd">                &gt;&gt;&gt; x,CH1=I.fetch_trace(1)</span>
<span class="sd">                &gt;&gt;&gt; x,CH2=I.fetch_trace(2)</span>
<span class="sd">                &gt;&gt;&gt; plot(x,CH1-CH2) #Voltage across the inductor                </span>
<span class="sd">                &gt;&gt;&gt; plot(x,CH2)     ##Voltage across the capacitor      </span>
<span class="sd">                &gt;&gt;&gt; show()              </span>
<span class="sd">    </span>
<span class="sd">            The following events take place when the above snippet runs</span>
<span class="sd">    </span>
<span class="sd">            #. The oscilloscope starts storing voltages present at CH1 and CH2 every 2 microseconds</span>
<span class="sd">            #. The output OD1 was enabled, and this causes the voltage between the L and C to approach OD1 voltage.</span>
<span class="sd">               (It may or may not oscillate)</span>
<span class="sd">            #. The data from CH1 and CH2 was read into x,CH1,CH2</span>
<span class="sd">            #. Both traces were plotted in order to visualize the Transient response of series LC</span>
<span class="sd">        </span>
<span class="sd">        :return: nothing</span>
<span class="sd">        </span>
<span class="sd">        .. seealso::            </span>
<span class="sd">            :func:`fetch_trace` , :func:`oscilloscope_progress` , :func:`capture1` , :func:`capture2` , :func:`capture4`</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">triggerornot</span><span class="o">=</span><span class="mh">0x80</span> <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="n">tg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timebase</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>  <span class="c"># Round off the timescale to 1/8uS units</span>
        <span class="n">CHOSA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel_one_input</span><span class="p">]</span><span class="o">.</span><span class="n">CHOSA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">num</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">&lt;</span><span class="mf">1.5</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
            <span class="k">if</span><span class="p">(</span><span class="n">samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">):</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel_one_input</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">TEN_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel_one_input</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_ONE</span><span class="p">)</span>        <span class="c">#read 1 channel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CHOSA</span><span class="o">|</span><span class="n">triggerornot</span><span class="p">)</span>     <span class="c">#channelk number</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">num</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">&lt;</span><span class="mf">1.75</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.75</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
            <span class="k">if</span><span class="p">(</span><span class="n">samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel_one_input</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">TEN_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel_one_input</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;CH2&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">TEN_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="s">&#39;CH2&#39;</span><span class="p">])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_TWO</span><span class="p">)</span>            <span class="c">#capture 2 channels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CHOSA</span><span class="o">|</span><span class="n">triggerornot</span><span class="p">)</span>             <span class="c">#channel 0 number</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">num</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">num</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">&lt;</span><span class="mf">1.75</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.75</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
            <span class="k">if</span><span class="p">(</span><span class="n">samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel_one_input</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span>\
            <span class="n">resolution</span><span class="o">=</span><span class="n">TEN_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel_one_input</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">chans</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;NONE&#39;</span><span class="p">,</span><span class="s">&#39;CH2&#39;</span><span class="p">,</span><span class="s">&#39;CH3&#39;</span><span class="p">,</span><span class="s">&#39;MIC&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">chans</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span>\
                <span class="n">resolution</span><span class="o">=</span><span class="n">TEN_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">chans</span><span class="p">[</span><span class="n">a</span><span class="p">]])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_FOUR</span><span class="p">)</span>           <span class="c">#read 4 channels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CHOSA</span><span class="o">|</span><span class="p">(</span><span class="n">CH123SA</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">triggerornot</span><span class="p">)</span>        <span class="c">#channel number</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">=</span><span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>         <span class="c">#number of samples per channel to record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>        <span class="c">#Timegap between samples.  8MHz timer clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="o">=</span><span class="n">num</span>
</div>
<div class="viewcode-block" id="Interface.capture_highres_traces"><a class="viewcode-back" href="../interface.html#interface.Interface.capture_highres_traces">[docs]</a>    <span class="k">def</span> <span class="nf">capture_highres_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instruct the ADC to start sampling. use fetch_trace to retrieve the data</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        =================== ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        =================== ============================================================================================</span>
<span class="sd">        channel             channel to acquire data from &#39;CH1&#39; ... &#39;CH9&#39;</span>
<span class="sd">        samples             Total points to store per channel. Maximum 3200 total.</span>
<span class="sd">        tg                  Timegap between two successive samples (in uSec)</span>
<span class="sd">        \*\*kwargs        </span>
<span class="sd">        </span>
<span class="sd">        \*trigger           Whether or not to trigger the oscilloscope based on the voltage level set by :func:`configure_trigger`</span>
<span class="sd">        =================== ============================================================================================</span>

<span class="sd">        </span>
<span class="sd">        :return: nothing</span>
<span class="sd">        </span>
<span class="sd">        .. seealso::</span>
<span class="sd">            </span>
<span class="sd">            :func:`fetch_trace` , :func:`oscilloscope_progress` , :func:`capture1` , :func:`capture2` , :func:`capture4`</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">triggerornot</span><span class="o">=</span><span class="mh">0x80</span> <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="n">tg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>

        <span class="n">CHOSA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">CHOSA</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">&lt;</span><span class="mf">2.8</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">=</span><span class="mf">2.8</span>
        <span class="k">if</span><span class="p">(</span><span class="n">samples</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">):</span><span class="n">samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">TWELVE_BIT</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CAPTURE_12BIT</span><span class="p">)</span>          <span class="c">#read 1 channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CHOSA</span><span class="o">|</span><span class="n">triggerornot</span><span class="p">)</span>     <span class="c">#channelk number</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">=</span><span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>         <span class="c">#number of samples to read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timebase</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>        <span class="c">#Timegap between samples.  8MHz timer clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="o">=</span><span class="mi">1</span>


    </div>
<div class="viewcode-block" id="Interface.fetch_trace"><a class="viewcode-back" href="../interface.html#interface.Interface.fetch_trace">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fetches a channel(1-4) captured by :func:`capture_traces` called prior to this, and returns xaxis,yaxis</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel_number  Any of the maximum of four channels that the oscilloscope captured. 1/2/3/4</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return: time array,voltage array</span>

<span class="sd">        .. seealso::</span>
<span class="sd">            </span>
<span class="sd">            :func:`capture_traces` , :func:`oscilloscope_progress`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fetch_channel__</span><span class="p">(</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="Interface.oscilloscope_progress"><a class="viewcode-back" href="../interface.html#interface.Interface.oscilloscope_progress">[docs]</a>    <span class="k">def</span> <span class="nf">oscilloscope_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the number of samples acquired by the capture routines, and the conversion_done status</span>
<span class="sd">        </span>
<span class="sd">        :return: conversion done(bool) ,samples acquired (number)</span>

<span class="sd">        &gt;&gt;&gt; I.start_capture(1,3200,2)</span>
<span class="sd">        &gt;&gt;&gt; print I.oscilloscope_progress()</span>
<span class="sd">        (0,46)</span>
<span class="sd">        &gt;&gt;&gt; time.sleep(3200*2e-6)</span>
<span class="sd">        &gt;&gt;&gt; print I.oscilloscope_progress()</span>
<span class="sd">        (1,3200)</span>
<span class="sd">        </span>
<span class="sd">        .. seealso::</span>
<span class="sd">            </span>
<span class="sd">            :func:`fetch_trace` , :func:`capture_traces`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conversion_done</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">samples</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_STATUS</span><span class="p">)</span>
            <span class="n">conversion_done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;disconnected!!&#39;</span>
            <span class="c">#sys.exit(1)</span>
        <span class="k">return</span> <span class="n">conversion_done</span><span class="p">,</span><span class="n">samples</span>
</div>
    <span class="k">def</span> <span class="nf">__fetch_channel__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches a section of data from any channel and stores it in the relevant instance of achan()</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel_number  channel number (1,2,3,4)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: True if successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span><span class="p">(</span><span class="n">channel_number</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Channel unavailable&#39;</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">samples</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c">#starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span><span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>        <span class="c">#reading int by int sometimes causes a communication error. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c">#starts with A0 on PIC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="o">-</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">samples</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data_splitting</span><span class="p">))</span>         <span class="c">#reading int by int may cause packets to be dropped. this works better.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fix_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[:</span><span class="n">samples</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>



    <span class="k">def</span> <span class="nf">__fetch_channel_oneshot__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches all data from given channel and stores it in the relevant instance of achan()</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel_number  channel number (1,2,3,4)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span><span class="o">=</span><span class="mi">0</span> 
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span><span class="p">(</span><span class="n">channel_number</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Channel unavailable&#39;</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPTURE_CHANNEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c">#starts with A0 on PIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">samples</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>        <span class="c">#reading int by int sometimes causes a communication error. this works better.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fix_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[:</span><span class="n">samples</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">True</span>


        
<div class="viewcode-block" id="Interface.configure_trigger"><a class="viewcode-back" href="../interface.html#interface.Interface.configure_trigger">[docs]</a>    <span class="k">def</span> <span class="nf">configure_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chan</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">voltage</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        configure trigger parameters for 10-bit capture commands</span>
<span class="sd">        The capture routines will wait till a rising edge of the input signal crosses the specified level.</span>
<span class="sd">        The trigger will timeout within 8mS, and capture routines will start regardless.</span>
<span class="sd">        </span>
<span class="sd">        These settings will not be used if the trigger option in the capture routines are set to False</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  =====================================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  =====================================================================================================================</span>
<span class="sd">        chan            channel . 0 or 1. corresponding to the channels being recorded by the capture routine(not the analog inputs)</span>
<span class="sd">        name            the name of the channel. &#39;CH1&#39;... &#39;V+&#39;</span>
<span class="sd">        voltage         The voltage level that should trigger the capture sequence(in Volts)</span>
<span class="sd">        ==============  =====================================================================================================================</span>

<span class="sd">        **Example**</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; I.configure_trigger(0,1.1)</span>
<span class="sd">        &gt;&gt;&gt; I.capture_traces(4,800,2)</span>
<span class="sd">        #Unless a timeout occured, the first point of this channel will be close to 1.1Volts</span>
<span class="sd">        &gt;&gt;&gt; I.fetch_trace(1)</span>
<span class="sd">        #This channel was acquired simultaneously with channel 1, </span>
<span class="sd">        #so it&#39;s triggered along with the first</span>
<span class="sd">        &gt;&gt;&gt; I.fetch_trace(2)</span>
<span class="sd">        </span>
<span class="sd">        .. seealso::</span>
<span class="sd">            </span>
<span class="sd">            :func:`capture_traces` , adc_example_</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CONFIGURE_TRIGGER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">chan</span><span class="p">)</span>    <span class="c">#Trigger channel</span>
        
        <span class="k">if</span> <span class="n">resolution</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">voltToCode10</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4095</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">voltToCode10</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">level</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>  <span class="c">#Trigger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

    
                </div>
<div class="viewcode-block" id="Interface.set_gain"><a class="viewcode-back" href="../interface.html#interface.Interface.set_gain">[docs]</a>    <span class="k">def</span> <span class="nf">set_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">gain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set the gain of the selected PGA</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         &#39;CH1&#39;,&#39;CH2&#39;</span>
<span class="sd">        gain            (0-7) -&gt; (1x,2x,4x,5x,8x,10x,16x,32x)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            The gain value applied to a channel will result in better resolution for small amplitude signals.</span>
<span class="sd">            </span>
<span class="sd">            However, values read using functions like :func:`get_average_voltage` or    :func:`capture_traces` </span>
<span class="sd">            will not be 2x, or 4x times the input signal. These are calibrated to return accurate values of the original input signal.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; I.set_gain(&#39;CH1&#39;,7)  #gain set to 32x on CH1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">gainPGA</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No amplifier exists on this channel :&#39;</span><span class="p">,</span><span class="n">channel</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setGain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_values</span><span class="p">[</span><span class="n">gain</span><span class="p">])</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_PGA_GAIN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">gainPGA</span><span class="p">)</span> <span class="c">#send the channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span> <span class="c">#send the gain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_values</span><span class="p">[</span><span class="n">gain</span><span class="p">]</span>


</div>
    <span class="k">def</span> <span class="nf">__calcCHOSA__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allAnalogChannels</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;not a valid channel name. selecting CH1&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcCHOSA__</span><span class="p">(</span><span class="s">&#39;CH1&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">source</span><span class="o">.</span><span class="n">CHOSA</span>


<div class="viewcode-block" id="Interface.get_average_voltage"><a class="viewcode-back" href="../interface.html#interface.Interface.get_average_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">get_average_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Return the voltage on the selected channel</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        +------------+-----------------------------------------------------------------------------------------+</span>
<span class="sd">        |Arguments   |Description                                                                              |</span>
<span class="sd">        +============+=========================================================================================+</span>
<span class="sd">        |channel_name| &#39;CH1&#39;,&#39;CH2&#39;,&#39;CH3&#39;, &#39;MIC&#39;,&#39;IN1&#39;,&#39;SEN&#39;,&#39;V+&#39;                                               |</span>
<span class="sd">        +------------+-----------------------------------------------------------------------------------------+</span>
<span class="sd">        |sleep       | read voltage in CPU sleep mode. not particularly useful. Also, Buggy.                   |</span>
<span class="sd">        +------------+-----------------------------------------------------------------------------------------+</span>
<span class="sd">        |\*\*kwargs  | Samples to average can be specified. eg. samples=100 will average a hundred readings    |</span>
<span class="sd">        +------------+-----------------------------------------------------------------------------------------+</span>


<span class="sd">        see :ref:`stream_video`</span>

<span class="sd">        Example:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; print I.get_average_voltage(&#39;CH4&#39;)</span>
<span class="sd">        1.002</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogInputSources</span><span class="p">[</span><span class="n">channel_name</span><span class="p">]</span><span class="o">.</span><span class="n">calPoly12</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">poly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_raw_average_voltage__</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;samples&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>       
        <span class="k">return</span>  <span class="n">val</span>


</div>
    <span class="k">def</span> <span class="nf">__get_raw_average_voltage__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Return the average of 16 raw 10-bit ADC values of the voltage on the selected channel</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================================</span>
<span class="sd">        channel_name    &#39;CH1&#39;, &#39;CH2&#39;, &#39;CH3&#39;, &#39;MIC&#39;, &#39;5V&#39;, &#39;IN1&#39;,&#39;SEN&#39;</span>
<span class="sd">        sleep           read voltage in CPU sleep mode</span>
<span class="sd">        ==============  ============================================================================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chosa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcCHOSA__</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_VOLTAGE_SUMMED</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sleep&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">)):</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">chosa</span><span class="o">|</span><span class="mh">0x80</span><span class="p">)</span><span class="c">#sleep mode conversion. buggy</span>
        <span class="k">else</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">chosa</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span> <span class="c">#2 Zeroes sent by UART. sleep or no sleep :p</span>
        <span class="n">V_sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span>  <span class="n">V_sum</span><span class="o">/</span><span class="mf">16.</span> <span class="c">#sum(V)/16.0  #</span>



    <span class="c">#-------------------------------------------------------------------------------------------------------------------#</span>

    <span class="c">#|===============================================DIGITAL SECTION====================================================|   </span>
    <span class="c">#|This section has commands related to digital measurement and control. These include the Logic Analyzer, frequency |</span>
    <span class="c">#|measurement calls, timing routines, digital outputs etc                               |</span>
    <span class="c">#-------------------------------------------------------------------------------------------------------------------#</span>
    <span class="k">def</span> <span class="nf">__calcDChan__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        accepts a string represention of a digital input ( &#39;ID1&#39;,&#39;ID2&#39;,&#39;ID3&#39;,&#39;ID4&#39;,&#39;CH1&#39;,&#39;Fin&#39; )</span>
<span class="sd">        and returns a corresponding number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">digital_channel_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">digital_channel_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39; invalid channel&#39;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s">&#39; , selecting ID1 instead &#39;</span>
            <span class="k">return</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">__get_high_freq__backup__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        retrieves the frequency of the signal connected to ID1. &gt;10MHz</span>
<span class="sd">        also good for lower frequencies, but avoid using it since</span>
<span class="sd">        the ADC cannot be used simultaneously. It shares a TIMER with the ADC.</span>
<span class="sd">        </span>
<span class="sd">        The input frequency is fed to a 32 bit counter for a period of 100mS.</span>
<span class="sd">        The value of the counter at the end of 100mS is used to calculate the frequency.</span>
<span class="sd">        </span>

<span class="sd">        see :ref:`freq_video`</span>


<span class="sd">        .. seealso:: :func:`get_freq`</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        pin             The input pin to measure frequency from : &#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return: frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_HIGH_FREQUENCY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">/</span><span class="mf">1.0e-1</span> <span class="c">#100mS sampling</span>

<div class="viewcode-block" id="Interface.get_high_freq"><a class="viewcode-back" href="../interface.html#interface.Interface.get_high_freq">[docs]</a>    <span class="k">def</span> <span class="nf">get_high_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        experimental feature. Attempt to use fewer timers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="c">#print hex(val)</span>
        <span class="k">return</span> <span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">/</span><span class="mf">1.0e-1</span> <span class="c">#100mS sampling</span>


</div>
<div class="viewcode-block" id="Interface.get_freq"><a class="viewcode-back" href="../interface.html#interface.Interface.get_freq">[docs]</a>    <span class="k">def</span> <span class="nf">get_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;Fin&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency measurement on IDx.</span>
<span class="sd">        Measures time taken for 16 rising edges of input signal.</span>
<span class="sd">        returns the frequency in Hertz</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         The input to measure frequency from. &#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        timeout         This is a blocking call which will wait for one full wavelength before returning the</span>
<span class="sd">                        calculated frequency.</span>
<span class="sd">                        Use the timeout option if you&#39;re unsure of the input signal.</span>
<span class="sd">                        returns 0 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return float: frequency</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        .. _timing_example:</span>
<span class="sd">        </span>
<span class="sd">            * connect SQR1 to ID1</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; I.sqr1(4000,25)</span>
<span class="sd">            &gt;&gt;&gt; print I.get_freq(&#39;ID1&#39;)</span>
<span class="sd">            4000.0</span>
<span class="sd">            &gt;&gt;&gt; print I.r2r_time(&#39;ID1&#39;)</span>
<span class="sd">            #time between successive rising edges</span>
<span class="sd">            0.00025</span>
<span class="sd">            &gt;&gt;&gt; print I.f2f_time(&#39;ID1&#39;)</span>
<span class="sd">            #time between successive falling edges</span>
<span class="sd">            0.00025</span>
<span class="sd">            &gt;&gt;&gt; print I.pulse_time(&#39;ID1&#39;)</span>
<span class="sd">            #may detect a low pulse, or a high pulse. Whichever comes first</span>
<span class="sd">            6.25e-05</span>
<span class="sd">            &gt;&gt;&gt; I.duty_cycle(&#39;ID1&#39;)</span>
<span class="sd">            #returns wavelength, high time</span>
<span class="sd">            (0.00025,6.25e-05)          </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_FREQUENCY</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">16</span><span class="o">*</span><span class="mf">64e6</span><span class="o">/</span><span class="n">t</span> <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c">#print x,tmt,timeout_msb</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span><span class="p">):</span><span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">freq</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Interface.r2r_time"><a class="viewcode-back" href="../interface.html#interface.Interface.r2r_time">[docs]</a>    <span class="k">def</span> <span class="nf">r2r_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Returns the time interval between two rising edges</span>
<span class="sd">        of input signal on ID1</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         The input to measure time between two rising edges.&#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        timeout         Use the timeout option if you&#39;re unsure of the input signal time period.</span>
<span class="sd">                        returns 0 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return float: time between two rising edges of input signal</span>
<span class="sd">        </span>
<span class="sd">        .. seealso:: timing_example_</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_TIMING</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span> <span class="n">EVERY_RISING_EDGE</span><span class="o">&lt;&lt;</span><span class="mi">2</span> <span class="o">|</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span><span class="p">):</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">rtime</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.f2f_time"><a class="viewcode-back" href="../interface.html#interface.Interface.f2f_time">[docs]</a>    <span class="k">def</span> <span class="nf">f2f_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Returns the time interval between two falling edges</span>
<span class="sd">        of input signal on ID1</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         The input to measure time between two falling edges. &#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        timeout         Use the timeout option if you&#39;re unsure of the input signal time period.</span>
<span class="sd">                        returns 0 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return float: time between two falling edges of input signal</span>

<span class="sd">        .. seealso:: timing_example_</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_TIMING</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span> <span class="n">EVERY_FALLING_EDGE</span><span class="o">&lt;&lt;</span><span class="mi">2</span> <span class="o">|</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>

        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span><span class="p">):</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">rtime</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.DutyCycle"><a class="viewcode-back" href="../interface.html#interface.Interface.DutyCycle">[docs]</a>    <span class="k">def</span> <span class="nf">DutyCycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        duty cycle measurement on channel</span>
<span class="sd">        </span>
<span class="sd">        returns wavelength(seconds), and length of first half of pulse(high time)</span>
<span class="sd">        </span>
<span class="sd">        low time = (wavelength - high time)</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         The input pin to measure wavelength and high time. &#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        timeout         Use the timeout option if you&#39;re unsure of the input signal time period.</span>
<span class="sd">                        returns 0 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return : wavelength,duty cycle</span>

<span class="sd">        .. seealso:: timing_example_</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_DUTY_CYCLE</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>   <span class="c">#rising edge has occurred</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>       <span class="c">#falling edge</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">print</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">edge</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span><span class="p">):</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">rtime</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">rtime</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">rtime</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>
</div>
<div class="viewcode-block" id="Interface.MeasureInterval"><a class="viewcode-back" href="../interface.html#interface.Interface.MeasureInterval">[docs]</a>    <span class="k">def</span> <span class="nf">MeasureInterval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel1</span><span class="p">,</span><span class="n">channel2</span><span class="p">,</span><span class="n">edge1</span><span class="p">,</span><span class="n">edge2</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Measures time intervals between two logic level changes on any two digital inputs(both can be the same)</span>

<span class="sd">        For example, one can measure the time interval between the occurence of a rising edge on ID1, and a falling edge on ID3.</span>
<span class="sd">        If the returned time is negative, it simply means that the event corresponding to channel2 occurred first.</span>
<span class="sd">        </span>
<span class="sd">        returns the calculated time</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel1        The input pin to measure first logic level change</span>
<span class="sd">        channel2        The input pin to measure second logic level change</span>
<span class="sd">                         -&#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        edge1           The type of level change to detect in order to start the timer</span>
<span class="sd">                            * &#39;rising&#39;</span>
<span class="sd">                            * &#39;falling&#39;</span>
<span class="sd">                            * &#39;four rising edges&#39;</span>
<span class="sd">        edge2           The type of level change to detect in order to stop the timer</span>
<span class="sd">                            * &#39;rising&#39;</span>
<span class="sd">                            * &#39;falling&#39;</span>
<span class="sd">                            * &#39;four rising edges&#39;</span>
<span class="sd">        timeout         Use the timeout option if you&#39;re unsure of the input signal time period.</span>
<span class="sd">                        returns -1 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return : time</span>

<span class="sd">        .. seealso:: timing_example_</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">INTERVAL_MEASUREMENTS</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel2</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">edge1</span>  <span class="o">==</span> <span class="s">&#39;rising&#39;</span><span class="p">:</span> <span class="n">params</span> <span class="o">|=</span> <span class="mi">3</span> 
        <span class="k">elif</span> <span class="n">edge1</span><span class="o">==</span><span class="s">&#39;falling&#39;</span><span class="p">:</span> <span class="n">params</span> <span class="o">|=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>              <span class="n">params</span> <span class="o">|=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="n">edge2</span>  <span class="o">==</span> <span class="s">&#39;rising&#39;</span><span class="p">:</span> <span class="n">params</span> <span class="o">|=</span> <span class="mi">3</span><span class="o">&lt;&lt;</span><span class="mi">3</span> 
        <span class="k">elif</span> <span class="n">edge2</span><span class="o">==</span><span class="s">&#39;falling&#39;</span><span class="p">:</span> <span class="n">params</span> <span class="o">|=</span> <span class="mi">2</span><span class="o">&lt;&lt;</span><span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>              <span class="n">params</span> <span class="o">|=</span> <span class="mi">4</span><span class="o">&lt;&lt;</span><span class="mi">3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="c">#print A,B</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span> <span class="ow">or</span> <span class="n">B</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="k">return</span> <span class="n">rtime</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.pulse_time"><a class="viewcode-back" href="../interface.html#interface.Interface.pulse_time">[docs]</a>    <span class="k">def</span> <span class="nf">pulse_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;CH1&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        pulse time measurement on ID1</span>
<span class="sd">        returns pulse length(s) of high pulse or low pulse. whichever occurs first</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        channel         The input pin to measure pulse width from.</span>
<span class="sd">                            * &#39;ID1&#39; , &#39;ID2&#39;, &#39;ID3&#39;, &#39;ID4&#39;, &#39;Fin&#39;</span>
<span class="sd">        timeout         Use the timeout option if you&#39;re unsure of the input signal time period.</span>
<span class="sd">                        returns 0 if timed out</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return float: pulse width in seconds</span>

<span class="sd">        .. seealso:: timing_example_</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_PULSE_TIME</span><span class="p">)</span>
        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">timeout</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span><span class="p">):</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="c">#print params[0]*1e6,params[1]*1e6</span>
        <span class="k">return</span> <span class="n">rtime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="Interface.capture_edges1"><a class="viewcode-back" href="../interface.html#interface.Interface.capture_edges1">[docs]</a>    <span class="k">def</span> <span class="nf">capture_edges1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">waiting_time</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        log timestamps of rising/falling edges on one digital input</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        =================   ======================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        =================   ======================================================================================================</span>
<span class="sd">        waiting_time          Total time to allow the logic analyzer to collect data.</span>
<span class="sd">                            This is implemented using a simple sleep routine, so if large delays will be involved,</span>
<span class="sd">                            refer to :func:`start_one_channel_LA` to start the acquisition, and :func:`fetch_LA_channels` to</span>
<span class="sd">                            retrieve data from the hardware after adequate time. The retrieved data is stored</span>
<span class="sd">                            in the array self.dchans[0].timestamps.</span>
<span class="sd">        keyword arguments</span>
<span class="sd">        channel             &#39;ID1&#39;,...,&#39;ID4&#39;</span>
<span class="sd">        trigger_channel     &#39;ID1&#39;,...,&#39;ID4&#39;</span>
<span class="sd">        channel_mode        acquisition mode\n</span>
<span class="sd">                            default value: 3</span>

<span class="sd">                            - EVERY_SIXTEENTH_RISING_EDGE = 5</span>
<span class="sd">                            - EVERY_FOURTH_RISING_EDGE    = 4</span>
<span class="sd">                            - EVERY_RISING_EDGE           = 3</span>
<span class="sd">                            - EVERY_FALLING_EDGE          = 2</span>
<span class="sd">                            - EVERY_EDGE                  = 1</span>
<span class="sd">                            - DISABLED                    = 0</span>
<span class="sd">        </span>
<span class="sd">        trigger_mode        same as channel_mode.</span>
<span class="sd">                                default_value : 3</span>

<span class="sd">        =================   ======================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return:  timestamp array in Seconds</span>

<span class="sd">        &gt;&gt;&gt; I.capture_edges(0.2,channel=&#39;ID1&#39;,trigger_channel=&#39;ID1&#39;,channel_mode=3,trigger_mode = 3)</span>
<span class="sd">        #captures rising edges only. with rising edge trigger on ID1</span>
<span class="sd">                    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aqchan</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">)</span>
        <span class="n">trchan</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_channel&#39;</span><span class="p">,</span><span class="n">aqchan</span><span class="p">)</span>

        <span class="n">aqmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel_mode&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">trmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_mode&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_one_channel_LA</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">aqchan</span><span class="p">,</span><span class="n">channel_mode</span><span class="o">=</span><span class="n">aqmode</span><span class="p">,</span><span class="n">trigger_channel</span><span class="o">=</span><span class="n">trchan</span><span class="p">,</span><span class="n">trigger_mode</span><span class="o">=</span><span class="n">trmode</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">waiting_time</span><span class="p">)</span>

        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_LA_initial_states</span><span class="p">()</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_long_data_from_LA</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#data[4][0] -&gt; initial state</span>
        <span class="k">return</span> <span class="n">tmp</span><span class="o">/</span><span class="mf">64e6</span>     


</div>
    <span class="k">def</span> <span class="nf">__start_one_channel_LA_backup__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trigger</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;ID1&#39;</span><span class="p">,</span><span class="n">maximum_time</span><span class="o">=</span><span class="mi">67</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        start logging timestamps of rising/falling edges on ID1</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        trigger            Bool . Enable edge trigger on ID1. use keyword argument edge=&#39;rising&#39; or &#39;falling&#39;</span>
<span class="sd">        channel            &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>
<span class="sd">        maximum_time       Total time to sample. If total time exceeds 67 seconds, a prescaler will be used in the reference clock</span>
<span class="sd">        kwargs</span>
<span class="sd">        triggger_channels  array of digital input names that can trigger the acquisition.eg. trigger= [&#39;ID1&#39;,&#39;ID2&#39;,&#39;ID3&#39;]</span>
<span class="sd">                           will triggger when a logic change specified by the keyword argument &#39;edge&#39; occurs</span>
<span class="sd">                           on either or the three specified trigger inputs.</span>
<span class="sd">        edge               &#39;rising&#39; or &#39;falling&#39; . trigger edge type for trigger_channels.</span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: Nothing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_ONE_CHAN_LA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="c">#trigchan bit functions</span>
            <span class="c"># b0 - trigger or not</span>
            <span class="c"># b1 - trigger edge . 1 =&gt; rising. 0 =&gt; falling</span>
            <span class="c"># b2, b3 - channel to acquire data from. ID1,ID2,ID3,ID4,COMPARATOR</span>
            <span class="c"># b4 - trigger channel ID1</span>
            <span class="c"># b5 - trigger channel ID2</span>
            <span class="c"># b6 - trigger channel ID3</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;trigger_channels&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trigger</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">trigchans</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_channels&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;ID1&#39;</span> <span class="ow">in</span> <span class="n">trigchans</span> <span class="p">:</span> <span class="n">trigger</span><span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;ID2&#39;</span> <span class="ow">in</span> <span class="n">trigchans</span> <span class="p">:</span> <span class="n">trigger</span><span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;ID3&#39;</span> <span class="ow">in</span> <span class="n">trigchans</span> <span class="p">:</span> <span class="n">trigger</span><span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trigger</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="c">#trigger on specified input channel if not trigger_channel argument provided</span>

        <span class="n">trigger</span> <span class="o">|=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;edge&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="s">&#39;rising&#39;</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">trigger</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">trigger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;long&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
            <span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="n">maximum_time</span><span class="o">*</span><span class="mf">1e6</span> <span class="c">#conversion to uS</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">EVERY_EDGE</span>

        <span class="c">#def start_one_channel_LA(self,**args):</span>
            <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            start logging timestamps of rising/falling edges on ID1</span>

<span class="sd">            .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">            ================== ======================================================================================================</span>
<span class="sd">            **Arguments** </span>
<span class="sd">            ================== ======================================================================================================</span>
<span class="sd">            args</span>
<span class="sd">            channel             &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>
<span class="sd">            trigger_channel     &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>

<span class="sd">            channel_mode        acquisition mode\n</span>
<span class="sd">                                default value: 1(EVERY_EDGE)</span>

<span class="sd">                                - EVERY_SIXTEENTH_RISING_EDGE = 5</span>
<span class="sd">                                - EVERY_FOURTH_RISING_EDGE    = 4</span>
<span class="sd">                                - EVERY_RISING_EDGE           = 3</span>
<span class="sd">                                - EVERY_FALLING_EDGE          = 2</span>
<span class="sd">                                - EVERY_EDGE                  = 1</span>
<span class="sd">                                - DISABLED                    = 0</span>
<span class="sd">        </span>
<span class="sd">            trigger_edge        1=Falling edge</span>
<span class="sd">                                0=Rising Edge</span>
<span class="sd">                                -1=Disable Trigger</span>

<span class="sd">            ================== ======================================================================================================</span>
<span class="sd">        </span>
<span class="sd">            :return: Nothing</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_ONE_CHAN_LA</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">aqchan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">))</span>
            <span class="n">aqmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel_mode&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="s">&#39;trigger_channel&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">trchan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">))</span>
                <span class="n">tredge</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_edge&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;trigger chan&#39;</span><span class="p">,</span><span class="n">trchan</span><span class="p">,</span><span class="s">&#39; trigger edge &#39;</span><span class="p">,</span><span class="n">tredge</span>
                <span class="k">if</span> <span class="n">tredge</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">trchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">tredge</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#no triggering</span>
            <span class="k">elif</span> <span class="s">&#39;trigger_edge&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">tredge</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_edge&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tredge</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">aqchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">tredge</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="mi">1</span><span class="p">)</span>  <span class="c">#trigger on acquisition channel</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#no triggering</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#no triggering</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">aqchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">aqmode</span><span class="p">)</span>
        
            
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;long&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
            <span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="mi">67</span><span class="o">*</span><span class="mf">1e6</span> <span class="c">#conversion to uS</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel_mode&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">initial_state_override</span><span class="o">=</span><span class="bp">False</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if trmode in [3,4,5]:</span>
<span class="sd">                a.initial_state_override = 2</span>
<span class="sd">            elif trmode == 2:</span>
<span class="sd">                a.initial_state_override = 1</span>
<span class="sd">            &#39;&#39;&#39;</span>




<div class="viewcode-block" id="Interface.start_one_channel_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.start_one_channel_LA">[docs]</a>    <span class="k">def</span> <span class="nf">start_one_channel_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        start logging timestamps of rising/falling edges on ID1</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        args</span>
<span class="sd">        channel            &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>
<span class="sd">        trigger_channel    &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>

<span class="sd">        channel_mode       acquisition mode.</span>
<span class="sd">                           default value: 1</span>

<span class="sd">                            - EVERY_SIXTEENTH_RISING_EDGE = 5</span>
<span class="sd">                            - EVERY_FOURTH_RISING_EDGE    = 4</span>
<span class="sd">                            - EVERY_RISING_EDGE           = 3</span>
<span class="sd">                            - EVERY_FALLING_EDGE          = 2</span>
<span class="sd">                            - EVERY_EDGE                  = 1</span>
<span class="sd">                            - DISABLED                    = 0</span>
<span class="sd">        </span>
<span class="sd">        trigger_mode       same as channel_mode.</span>
<span class="sd">                           default_value : 3</span>

<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: Nothing</span>

<span class="sd">        see :ref:`LA_video`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_ALTERNATE_ONE_CHAN_LA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">aqchan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">))</span>
        <span class="n">aqmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel_mode&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">trchan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">))</span>
        <span class="n">trmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_mode&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">aqchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">aqmode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">trchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">trmode</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;long&#39;</span>
        <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="mi">67</span><span class="o">*</span><span class="mf">1e6</span> <span class="c">#conversion to uS</span>
        <span class="n">a</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;channel_mode&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trmode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">initial_state_override</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">trmode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">initial_state_override</span> <span class="o">=</span> <span class="mi">1</span>


</div>
<div class="viewcode-block" id="Interface.start_two_channel_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.start_two_channel_LA">[docs]</a>    <span class="k">def</span> <span class="nf">start_two_channel_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trigger</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">maximum_time</span><span class="o">=</span><span class="mi">67</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        start logging timestamps of rising/falling edges on ID1,AD2     </span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        trigger         Bool . Enable rising edge trigger on ID1</span>
<span class="sd">        maximum_time    Total time to sample. If total time exceeds 67 seconds, a prescaler will be used in the reference clock</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        ::</span>

<span class="sd">            &quot;fetch_long_data_from_dma(samples,1)&quot; to get data acquired from channel 1</span>
<span class="sd">            &quot;fetch_long_data_from_dma(samples,2)&quot; to get data acquired from channel 2</span>
<span class="sd">            The read data can be accessed from self.dchans[0 or 1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chans</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_TWO_CHAN_LA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">trigger</span><span class="o">|</span><span class="n">chans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">modes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c">#Modes. four bits each</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">chans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">chans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c">#Channels. four bits each</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>  <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;long&#39;</span><span class="p">;</span><span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="n">maximum_time</span><span class="o">*</span><span class="mf">1e6</span> <span class="c">#conversion to uS</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">modes</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="o">=</span><span class="n">chans</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="Interface.start_three_channel_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.start_three_channel_LA">[docs]</a>    <span class="k">def</span> <span class="nf">start_three_channel_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        start logging timestamps of rising/falling edges on ID1,ID2,ID3</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        args</span>
<span class="sd">        trigger_channel     &#39;ID1&#39;,...&#39;LMETER&#39;,&#39;CH1&#39;</span>

<span class="sd">        modes               modes for each channel. Array .\n</span>
<span class="sd">                            default value: [1,1,1]</span>

<span class="sd">                            - EVERY_SIXTEENTH_RISING_EDGE = 5</span>
<span class="sd">                            - EVERY_FOURTH_RISING_EDGE    = 4</span>
<span class="sd">                            - EVERY_RISING_EDGE           = 3</span>
<span class="sd">                            - EVERY_FALLING_EDGE          = 2</span>
<span class="sd">                            - EVERY_EDGE                  = 1</span>
<span class="sd">                            - DISABLED                    = 0</span>
<span class="sd">        </span>
<span class="sd">        trigger_mode        same as modes(previously documented keyword argument)</span>
<span class="sd">                            default_value : 3</span>

<span class="sd">        ================== ======================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: Nothing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_THREE_CHAN_LA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;modes&#39;</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">trchan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calcDChan__</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_channel&#39;</span><span class="p">,</span><span class="s">&#39;ID1&#39;</span><span class="p">))</span>
        <span class="n">trmode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_mode&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="n">modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">modes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">trchan</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">trmode</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
            <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;int&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="mf">1e3</span> <span class="c">#&lt; 1 mS between each consecutive level changes in the input signal must be ensured to prevent rollover</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">modes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trmode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">initial_state_override</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">trmode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">initial_state_override</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>


</div>
<div class="viewcode-block" id="Interface.start_four_channel_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.start_four_channel_LA">[docs]</a>    <span class="k">def</span> <span class="nf">start_four_channel_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trigger</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">maximum_time</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Four channel Logic Analyzer.</span>
<span class="sd">        start logging timestamps from a 64MHz counter to record level changes on ID1,ID2,ID3,ID4.</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        trigger         Bool . Enable rising edge trigger on ID1</span>

<span class="sd">        maximum_time    Maximum delay expected between two logic level changes.\n</span>
<span class="sd">                        If total time exceeds 1 mS, a prescaler will be used in the reference clock</span>
<span class="sd">                        However, this only refers to the maximum time between two successive level changes. If a delay larger</span>
<span class="sd">                        than .26 S occurs, it will be truncated by modulo .26 S.\n</span>
<span class="sd">                        If you need to record large intervals, try single channel/two channel modes which use 32 bit counters</span>
<span class="sd">                        capable of time interval up to 67 seconds.</span>

<span class="sd">        mode            modes for each channel. List with four elements\n</span>
<span class="sd">                        default values: [1,1,1,1]</span>

<span class="sd">                        - EVERY_SIXTEENTH_RISING_EDGE = 5</span>
<span class="sd">                        - EVERY_FOURTH_RISING_EDGE    = 4</span>
<span class="sd">                        - EVERY_RISING_EDGE           = 3</span>
<span class="sd">                        - EVERY_FALLING_EDGE          = 2</span>
<span class="sd">                        - EVERY_EDGE                  = 1</span>
<span class="sd">                        - DISABLED                    = 0</span>

<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return: Nothing</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            Use :func:`fetch_long_data_from_LA` (points to read,x) to get data acquired from channel x.</span>
<span class="sd">            The read data can be accessed from :class:`~Interface.dchans` [x-1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="p">);</span>
        <span class="n">prescale</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if(maximum_time &gt; 0.26):</span>
<span class="sd">            #print &#39;too long for 4 channel. try 2/1 channels&#39;</span>
<span class="sd">            prescale = 3</span>
<span class="sd">        elif(maximum_time &gt; 0.0655):</span>
<span class="sd">            prescale = 3</span>
<span class="sd">        elif(maximum_time &gt; 0.008191):</span>
<span class="sd">            prescale = 2</span>
<span class="sd">        elif(maximum_time &gt; 0.0010239):</span>
<span class="sd">            prescale = 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_FOUR_CHAN_LA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">prescale</span><span class="p">)</span> <span class="c">#prescaler</span>
        <span class="n">trigopts</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">trigopts</span> <span class="o">|=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_ID1&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">trigopts</span> <span class="o">|=</span> <span class="mi">8</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_ID2&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">trigopts</span> <span class="o">|=</span> <span class="mi">16</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;trigger_ID3&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">trigopts</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span> <span class="n">trigger</span><span class="o">|=</span><span class="mi">4</span>    <span class="c">#select one trigger channel(ID1) if none selected</span>
        <span class="n">trigopts</span> <span class="o">|=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;edge&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="s">&#39;rising&#39;</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">trigger</span><span class="o">|=</span><span class="n">trigopts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">trigger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">prescaler</span> <span class="o">=</span> <span class="n">prescale</span>
            <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
            <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">=</span><span class="s">&#39;int&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">maximum_time</span> <span class="o">=</span> <span class="n">maximum_time</span><span class="o">*</span><span class="mf">1e6</span> <span class="c">#conversion to uS</span>
            <span class="n">a</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>


</div>
<div class="viewcode-block" id="Interface.get_LA_initial_states"><a class="viewcode-back" href="../interface.html#interface.Interface.get_LA_initial_states">[docs]</a>    <span class="k">def</span> <span class="nf">get_LA_initial_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        fetches the initial states before the logic analyser started</span>

<span class="sd">        :return: chan1 progress,chan2 progress,chan3 progress,chan4 progress,[ID1,ID2,ID3,ID4]. eg. [1,0,1,1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_INITIAL_DIGITAL_STATES</span><span class="p">)</span>
        <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="n">A</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span><span class="o">-</span><span class="n">initial</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">B</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span><span class="o">-</span><span class="n">initial</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">C</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span><span class="o">-</span><span class="n">initial</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">D</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span><span class="o">-</span><span class="n">initial</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="n">s_err</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">A</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="k">if</span> <span class="n">B</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="k">if</span> <span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        <span class="k">if</span> <span class="n">D</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_SAMPLES</span><span class="o">/</span><span class="mi">4</span>
        
        <span class="k">if</span> <span class="n">A</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">A</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">B</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">B</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">C</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">C</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">D</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span>

        <span class="c">#print [(s&amp;1!=0),(s&amp;2!=0),(s&amp;4!=0),(s&amp;8!=0)],[(s_err&amp;1!=0),(s_err&amp;2!=0),(s_err&amp;4!=0),(s&amp;8!=0)]</span>
        <span class="k">return</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,[(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">1</span><span class="o">!=</span><span class="mi">0</span><span class="p">),(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span><span class="p">),(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">4</span><span class="o">!=</span><span class="mi">0</span><span class="p">),(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">8</span><span class="o">!=</span><span class="mi">0</span><span class="p">)]</span>

        </div>
<div class="viewcode-block" id="Interface.fetch_int_data_from_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.fetch_int_data_from_LA">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_int_data_from_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">bytes</span><span class="p">,</span><span class="n">chan</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        fetches the data stored by DMA. integer address increments</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        bytes:          number of readings(integers) to fetch</span>
<span class="sd">        chan:           channel number (1-4)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FETCH_INT_DMA_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">chan</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">bytes</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
            <span class="n">t</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span> <span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">trim_zeros</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">rollovers</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">b</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">&lt;</span><span class="n">t</span><span class="p">[</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">rollovers</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">t</span><span class="p">[</span><span class="n">b</span><span class="p">:]</span><span class="o">+=</span><span class="mi">65535</span>
            <span class="n">b</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span>  <span class="n">t</span>
</div>
<div class="viewcode-block" id="Interface.fetch_long_data_from_LA"><a class="viewcode-back" href="../interface.html#interface.Interface.fetch_long_data_from_LA">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_long_data_from_LA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">bytes</span><span class="p">,</span><span class="n">chan</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        fetches the data stored by DMA. long address increments</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        bytes:          number of readings(long integers) to fetch</span>
<span class="sd">        chan:           channel number (1,2)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TIMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FETCH_LONG_DMA_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">chan</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ss</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trim_zeros</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">tmp</span>

</div>
<div class="viewcode-block" id="Interface.fetch_LA_channels"><a class="viewcode-back" href="../interface.html#interface.Interface.fetch_LA_channels">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_LA_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trigchan</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads and stores the channels in self.dchans.</span>

<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        trigchan:       channel number which should be treated as a trigger. (1,2,3,4). Its first timestamp</span>
<span class="sd">                        is subtracted from the rest of the channels.</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_LA_initial_states</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">channel_number</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">__fetch_LA_channel__</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
    <span class="k">def</span> <span class="nf">__fetch_LA_channel__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">,</span><span class="n">initial_states</span><span class="p">):</span>
        <span class="n">s</span><span class="o">=</span><span class="n">initial_states</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dchans</span><span class="p">[</span><span class="n">channel_number</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;channel unavailable&#39;</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">datatype</span><span class="o">==</span><span class="s">&#39;int&#39;</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_int_data_from_LA</span><span class="p">(</span><span class="n">initial_states</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_long_data_from_LA</span><span class="p">(</span><span class="n">initial_states</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">channel_number</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
        
        <span class="c">#offset=0</span>
        <span class="c">#a.timestamps -= offset</span>
        <span class="n">a</span><span class="o">.</span><span class="n">generate_axes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>



<div class="viewcode-block" id="Interface.get_states"><a class="viewcode-back" href="../interface.html#interface.Interface.get_states">[docs]</a>    <span class="k">def</span> <span class="nf">get_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the state of the digital inputs. returns dictionary with keys &#39;ID1&#39;,&#39;ID2&#39;,&#39;ID3&#39;,&#39;ID4&#39;</span>

<span class="sd">        &gt;&gt;&gt; print get_states()</span>
<span class="sd">        {&#39;ID1&#39;: True, &#39;ID2&#39;: True, &#39;ID3&#39;: True, &#39;ID4&#39;: False}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">DIN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_STATES</span><span class="p">)</span>
        <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;ID1&#39;</span><span class="p">:(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">1</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="s">&#39;ID2&#39;</span><span class="p">:(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="s">&#39;ID3&#39;</span><span class="p">:(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">4</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="s">&#39;ID4&#39;</span><span class="p">:(</span><span class="n">s</span><span class="o">&amp;</span><span class="mi">8</span><span class="o">!=</span><span class="mi">0</span><span class="p">)}</span>
</div>
<div class="viewcode-block" id="Interface.get_state"><a class="viewcode-back" href="../interface.html#interface.Interface.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the logic level on the specified input (ID1,ID2,ID3, or ID4)</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments**    Description</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        input_id        the input channel</span>
<span class="sd">                            &#39;ID1&#39; -&gt; state of ID1</span>
<span class="sd">                            &#39;ID4&#39; -&gt; state of ID4</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        &gt;&gt;&gt; print I.get_state(I.ID1)</span>
<span class="sd">        False</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_states</span><span class="p">()[</span><span class="n">input_id</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Interface.set_state"><a class="viewcode-back" href="../interface.html#interface.Interface.set_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        set the logic level on digital outputs SQR1,SQR2,SQR3,SQR4</span>
<span class="sd">        On older units, SQR3,SQR4 were called OD1,OD2. Both mnemonics will work.</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        \*\*kwargs      SQR1,SQR2,SQR3,SQR4</span>
<span class="sd">                        states(0 or 1)</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        &gt;&gt;&gt; I.set_state(SQR1=1,SQR2=0)</span>
<span class="sd">        sets SQR1 HIGH, SQR2 LOw, but leave SQR3,SQR4 untouched.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;OD1&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x40</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;OD1&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;OD2&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x80</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;OD2&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;SQR1&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x10</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SQR1&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;SQR2&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x20</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SQR2&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;SQR3&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x40</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SQR3&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;SQR4&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">|=</span> <span class="mh">0x80</span><span class="o">|</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;SQR4&#39;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">DOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_STATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>


</div>
    <span class="k">def</span> <span class="nf">__get_capacitor_range__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ctime</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAP_RANGE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">ctime</span><span class="p">)</span> 
        <span class="n">V_sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">V</span><span class="o">=</span><span class="n">V_sum</span><span class="o">*</span><span class="mf">3.3</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">4095</span>
        <span class="n">C</span> <span class="o">=</span> <span class="o">-</span><span class="n">ctime</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">/</span><span class="mf">1e4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">V</span><span class="o">/</span><span class="mf">3.3</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">V</span><span class="p">,</span><span class="n">C</span>

<div class="viewcode-block" id="Interface.get_capacitor_range"><a class="viewcode-back" href="../interface.html#interface.Interface.get_capacitor_range">[docs]</a>    <span class="k">def</span> <span class="nf">get_capacitor_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Charges a capacitor connected to IN1 via a 20K resistor from a 3.3V source for a fixed interval</span>
<span class="sd">        Returns the capacitance calculated using the formula Vc = Vs(1-exp(-t/RC))</span>
<span class="sd">        This function allows an estimation of the parameters to be used with the :func:`get_capacitance` function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span><span class="o">=</span><span class="mi">10</span>
        <span class="n">P</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">50e-12</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">P</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_capacitor_range__</span><span class="p">(</span><span class="mi">50</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">a</span><span class="p">)))</span>
            <span class="k">if</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">1.5</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">3.28</span><span class="p">:</span> <span class="c">#pico farads range. Values will be incorrect using this method</span>
                    <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mf">50e-12</span>
                <span class="k">break</span>
        <span class="k">return</span>  <span class="n">P</span>

</div>
<div class="viewcode-block" id="Interface.get_capacitance"><a class="viewcode-back" href="../interface.html#interface.Interface.get_capacitance">[docs]</a>    <span class="k">def</span> <span class="nf">get_capacitance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c">#time in uS</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        measures capacitance of component connected between IN1 and ground</span>

<span class="sd">        </span>
<span class="sd">        :return: Capacitance (F)</span>

<span class="sd">        Constant Current Charging</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>

<span class="sd">            Q_{stored} = C*V</span>
<span class="sd">            </span>
<span class="sd">            I_{constant}*time = C*V</span>
<span class="sd">            </span>
<span class="sd">            C = I_{constant}*time/V_{measured}</span>

<span class="sd">        Also uses Constant Voltage Charging via 20K resistor if required.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">GOOD_VOLTS</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.8</span><span class="p">]</span>
        <span class="n">CT</span><span class="o">=</span><span class="mi">100</span>
        <span class="n">CR</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">V</span><span class="p">,</span><span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_capacitance__</span><span class="p">(</span><span class="n">CR</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">CT</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CT</span><span class="o">&gt;</span><span class="mi">30000</span> <span class="ow">and</span> <span class="n">V</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Capacitance too high for this method&#39;</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">&gt;</span><span class="n">GOOD_VOLTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">V</span><span class="o">&lt;</span><span class="n">GOOD_VOLTS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">C</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">&lt;</span><span class="n">GOOD_VOLTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">V</span><span class="o">&gt;</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="n">CT</span><span class="o">&lt;</span><span class="mi">40000</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">GOOD_VOLTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">V</span> <span class="o">&gt;</span><span class="mf">1.1</span> <span class="ow">and</span> <span class="n">iterations</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">CT</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">CT</span><span class="o">*</span><span class="n">GOOD_VOLTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">V</span><span class="p">)</span>
                    <span class="n">iterations</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">print</span> <span class="s">&#39;increased CT &#39;</span><span class="p">,</span><span class="n">CT</span>
                <span class="k">elif</span> <span class="n">iterations</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">C</span>
            <span class="k">elif</span> <span class="n">V</span><span class="o">&lt;=</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="n">CR</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">CR</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">CR</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_capacitor_range</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">__get_capacitance__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_range</span><span class="p">,</span><span class="n">trim</span><span class="p">,</span> <span class="n">Charge_Time</span><span class="p">):</span>  <span class="c">#time in uS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="n">currents</span><span class="o">=</span><span class="p">[</span><span class="mf">0.55e-3</span><span class="p">,</span><span class="mf">0.55e-6</span><span class="p">,</span><span class="mf">0.55e-5</span><span class="p">,</span><span class="mf">0.55e-4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CAPACITANCE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">current_range</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">trim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="mi">31</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">trim</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="mi">32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">trim</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">Charge_Time</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">Charge_Time</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">+.</span><span class="mo">02</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="mf">3.3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span><span class="o">/</span><span class="mi">4095</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">Charge_Current</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="n">current_range</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">100</span><span class="o">+</span><span class="n">trim</span><span class="p">)</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="k">if</span> <span class="n">V</span><span class="p">:</span><span class="n">C</span> <span class="o">=</span> <span class="n">Charge_Current</span><span class="o">*</span><span class="n">Charge_Time</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOCKET_CAPACITANCE</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#print &#39;Current if C=470pF :&#39;,V*(470e-12+self.SOCKET_CAPACITANCE)/(Charge_Time*1e-6)</span>
        <span class="k">return</span> <span class="n">V</span><span class="p">,</span><span class="n">C</span>


<div class="viewcode-block" id="Interface.get_ctmu_voltage"><a class="viewcode-back" href="../interface.html#interface.Interface.get_ctmu_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">get_ctmu_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">Crange</span><span class="p">,</span><span class="n">tgen</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_ctmu_voltage(5,2)  will activate a constant current source of 5.5uA on IN1 and then measure the voltage at the output.</span>
<span class="sd">        If a diode is used to connect IN1 to ground, the forward voltage drop of the diode will be returned. e.g. .6V for a 4148diode.</span>
<span class="sd">        </span>
<span class="sd">        If a resistor is connected, ohm&#39;s law will be followed within reasonable limits</span>
<span class="sd">        </span>
<span class="sd">        channel=5 for IN1</span>
<span class="sd">        </span>
<span class="sd">        CRange=0   implies 550uA</span>
<span class="sd">        CRange=1   implies 0.55uA</span>
<span class="sd">        CRange=2   implies 5.5uA</span>
<span class="sd">        CRange=3   implies 55uA</span>
<span class="sd">        </span>
<span class="sd">        :return: Voltage</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">if</span> <span class="n">channel</span><span class="o">==</span><span class="s">&#39;CAP&#39;</span><span class="p">:</span><span class="n">channel</span><span class="o">=</span><span class="mi">5</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">GET_CTMU_VOLTAGE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">channel</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">Crange</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">tgen</span><span class="o">&lt;&lt;</span><span class="mi">7</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getByte__</span><span class="p">()</span>    <span class="c">#junk byte &#39;0&#39; sent since UART was in IDLE mode and needs to recover.</span>
        <span class="c">#V = [self.H.__getInt__() for a in range(16)]</span>
        <span class="c">#print V</span>
        <span class="c">#v=sum(V)</span>
        <span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span> <span class="c">#16*voltage across the current source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="n">V</span><span class="o">=</span><span class="mf">3.3</span><span class="o">*</span><span class="n">v</span><span class="o">/</span><span class="mf">15.</span><span class="o">/</span><span class="mi">4096</span>
        <span class="k">return</span> <span class="n">V</span>
            
</div>
<div class="viewcode-block" id="Interface.restoreStandalone"><a class="viewcode-back" href="../interface.html#interface.Interface.restoreStandalone">[docs]</a>    <span class="k">def</span> <span class="nf">restoreStandalone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the device, and standalone mode will be enabled if an OLED is connected to the I2C port</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">RESTORE_STANDALONE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.resetHardware"><a class="viewcode-back" href="../interface.html#interface.Interface.resetHardware">[docs]</a>    <span class="k">def</span> <span class="nf">resetHardware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the device, and standalone mode will be enabled if an OLED is connected to the I2C port</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">RESTORE_STANDALONE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.read_flash"><a class="viewcode-back" href="../interface.html#interface.Interface.read_flash">[docs]</a>    <span class="k">def</span> <span class="nf">read_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">page</span><span class="p">,</span><span class="n">location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads 16 BYTES from the specified location</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        page                page number. 20 pages with 2KBytes each</span>
<span class="sd">        location            The flash location(0 to 63) to read from .</span>
<span class="sd">        ================    ============================================================================================</span>

<span class="sd">        :return: a string of 16 characters read from the location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">READ_FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>   <span class="c">#send the page number. 20 pages with 2K bytes each</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>   <span class="c">#send the location</span>
        <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ss</span>
</div>
<div class="viewcode-block" id="Interface.read_bulk_flash"><a class="viewcode-back" href="../interface.html#interface.Interface.read_bulk_flash">[docs]</a>    <span class="k">def</span> <span class="nf">read_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">page</span><span class="p">,</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads BYTES from the specified location</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        page                Block number. 0-20. each block is 2kB.</span>
<span class="sd">        bytes               Total bytes to read</span>
<span class="sd">        ================    ============================================================================================</span>

<span class="sd">        :return: a string of 16 characters read from the location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">READ_BULK_FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>   <span class="c">#send the location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="n">ss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ss</span>

</div>
<div class="viewcode-block" id="Interface.write_flash"><a class="viewcode-back" href="../interface.html#interface.Interface.write_flash">[docs]</a>    <span class="k">def</span> <span class="nf">write_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">page</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="n">string_to_write</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a 16 BYTE string to the selected location (0-63)</span>

<span class="sd">        DO NOT USE THIS UNLESS YOU&#39;RE ABSOLUTELY SURE KNOW THIS!</span>
<span class="sd">        YOU MAY END UP OVERWRITING THE CALIBRATION DATA, AND WILL HAVE</span>
<span class="sd">        TO GO THROUGH THE TROUBLE OF GETTING IT FROM THE MANUFACTURER AND</span>
<span class="sd">        REFLASHING IT.</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        page                page number. 20 pages with 2KBytes each</span>
<span class="sd">        location            The flash location(0 to 63) to write to.</span>
<span class="sd">        string_to_write     a string of 16 characters can be written to each location</span>
<span class="sd">        ================    ============================================================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string_to_write</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">):</span><span class="n">string_to_write</span><span class="o">+=</span><span class="s">&#39;.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WRITE_FLASH</span><span class="p">)</span>    <span class="c">#indicate a flash write coming through</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>   <span class="c">#send the page number. 20 pages with 2K bytes each</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>   <span class="c">#send the location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string_to_write</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.write_bulk_flash"><a class="viewcode-back" href="../interface.html#interface.Interface.write_bulk_flash">[docs]</a>    <span class="k">def</span> <span class="nf">write_bulk_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a byte array to the entire flash page. Erases any other data</span>

<span class="sd">        DO NOT USE THIS UNLESS YOU&#39;RE ABSOLUTELY SURE KNOW THIS!</span>
<span class="sd">        YOU MAY END UP OVERWRITING THE CALIBRATION DATA, AND WILL HAVE</span>
<span class="sd">        TO GO THROUGH THE TROUBLE OF GETTING IT FROM THE MANUFACTURER AND</span>
<span class="sd">        REFLASHING IT.</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ================    ============================================================================================</span>
<span class="sd">        location            Block number. 0-20. each block is 2kB.</span>
<span class="sd">        bytearray           Array to dump onto flash. Max size 2048 bytes</span>
<span class="sd">        ================    ============================================================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&#39;Dumping &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">),</span><span class="s">&#39; bytes into flash&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">FLASH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WRITE_BULK_FLASH</span><span class="p">)</span>   <span class="c">#indicate a flash write coming through</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">))</span>  <span class="c">#send the length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="c">#Printer(&#39;Bytes written: %d&#39;%(n+1))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>



</div>
<div class="viewcode-block" id="Interface.get_temperature"><a class="viewcode-back" href="../interface.html#interface.Interface.get_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the processor&#39;s temperature</span>
<span class="sd">        </span>
<span class="sd">        :return: Chip Temperature in degree Celcius</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ctmu_voltage</span><span class="p">(</span><span class="mb">0b11110</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">783.24</span><span class="o">-</span><span class="n">V</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">/</span><span class="mf">1.87</span>
        

</div>
<div class="viewcode-block" id="Interface.set_sine1"><a class="viewcode-back" href="../interface.html#interface.Interface.set_sine1">[docs]</a>    <span class="k">def</span> <span class="nf">set_sine1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of wavegen</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        frequency       Frequency to set on wave generator 1. </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :return: frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;freq too low&#39;</span>
            <span class="k">return</span> <span class="mi">0</span>        
        <span class="k">elif</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">1100</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="n">table_size</span><span class="p">))</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">wavelength</span><span class="o">/</span><span class="n">table_size</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SINE1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">HIGHRES</span><span class="p">)</span>    <span class="c">#use larger table for low frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">freq</span>


</div>
<div class="viewcode-block" id="Interface.set_sine2"><a class="viewcode-back" href="../interface.html#interface.Interface.set_sine2">[docs]</a>    <span class="k">def</span> <span class="nf">set_sine2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of wavegen</span>
<span class="sd">                </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        frequency       Frequency to set on wave generator 1. </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;freq too low&#39;</span>
            <span class="k">return</span> <span class="mi">0</span>        
        <span class="k">elif</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">1100</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">64.e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="n">table_size</span><span class="p">))</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mf">64.e6</span><span class="o">/</span><span class="n">wavelength</span><span class="o">/</span><span class="n">table_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SINE2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">HIGHRES</span><span class="p">)</span>    <span class="c">#use larger table for low frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">freq</span>
</div>
<div class="viewcode-block" id="Interface.set_sine_phase"><a class="viewcode-back" href="../interface.html#interface.Interface.set_sine_phase">[docs]</a>    <span class="k">def</span> <span class="nf">set_sine_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">phase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of wavegen</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        frequency       Frequency to set on both wave generators</span>
<span class="sd">        phase           Phase difference between the two. 0-360 degrees</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        :return: frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;freq too low&#39;</span>
            <span class="k">return</span> <span class="mi">0</span>        
        <span class="k">elif</span> <span class="n">freq</span><span class="o">&lt;</span><span class="mi">1100</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">HIGHRES</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">table_size</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="n">table_size</span><span class="p">))</span>
        <span class="n">retfreq</span> <span class="o">=</span> <span class="mf">64.e6</span><span class="o">/</span><span class="n">wavelength</span><span class="o">/</span><span class="n">table_size</span>
        
        <span class="n">phase_coarse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">table_size</span><span class="o">*</span><span class="p">(</span> <span class="n">phase</span><span class="p">)</span><span class="o">/</span><span class="mf">360.</span>  <span class="p">)</span>
        <span class="n">phase_fine</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wavelength</span><span class="o">*</span><span class="p">(</span><span class="n">phase</span> <span class="o">-</span> <span class="p">(</span><span class="n">phase_coarse</span><span class="p">)</span><span class="o">*</span><span class="mf">360.</span><span class="o">/</span><span class="n">table_size</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">360.</span><span class="o">/</span><span class="n">table_size</span><span class="p">))</span>

        <span class="n">phase_coarse</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">table_size</span><span class="o">*</span><span class="p">(</span> <span class="n">freq</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="mf">360.</span>  <span class="p">)</span> <span class="c"># PHASE CORRECTION. </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_BOTH_WG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>        <span class="c">#not really wavelength. time between each datapoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>        <span class="c">#not really wavelength. time between each datapoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">phase_coarse</span><span class="p">)</span>    <span class="c">#table position for phase adjust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">phase_fine</span><span class="p">)</span>      <span class="c">#timer delay / fine phase adjust</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">((</span><span class="n">HIGHRES</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">HIGHRES</span><span class="p">))</span>     <span class="c">#use larger table for low frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">retfreq</span>

</div>
<div class="viewcode-block" id="Interface.load_waveform"><a class="viewcode-back" href="../interface.html#interface.Interface.load_waveform">[docs]</a>    <span class="k">def</span> <span class="nf">load_waveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">span</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load an arbitrary waveform to the waveform generators</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        num             The waveform generator to alter. 1 or 2</span>
<span class="sd">        function            A function that will be used to generate the datapoints</span>
<span class="sd">        span                the range of values in which to evaluate the given function</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        example::</span>
<span class="sd">          </span>
<span class="sd">          &gt;&gt;&gt; fn = lambda x:abs(x-50)  #Triangular waveform </span>
<span class="sd">          &gt;&gt;&gt; self.I.load_waveform(fn,[0,100])</span>
<span class="sd">          #Load triangular wave to wavegen 1</span>
<span class="sd">          </span>
<span class="sd">          #Load sinusoidal wave to wavegen 2</span>
<span class="sd">          &gt;&gt;&gt; self.I.load_waveform(2,np.sin,[0,2*np.pi])</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">x1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">512</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y1</span><span class="o">=</span><span class="n">function</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">y1</span><span class="o">-=</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">y1</span><span class="o">/=</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="mi">512</span> <span class="o">-</span> <span class="mi">512</span><span class="o">*</span><span class="n">y1</span> <span class="p">)))</span>

        <span class="n">x2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">32</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y2</span><span class="o">=</span><span class="n">function</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
        <span class="n">y2</span><span class="o">-=</span><span class="nb">min</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">y2</span><span class="o">/=</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">64</span><span class="o">*</span><span class="n">y2</span> <span class="p">)))</span>

        <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">num</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">LOAD_WAVEFORM1</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">num</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">LOAD_WAVEFORM2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        
        

</div>
<div class="viewcode-block" id="Interface.set_pvs1"><a class="viewcode-back" href="../interface.html#interface.Interface.set_pvs1">[docs]</a>    <span class="k">def</span> <span class="nf">set_pvs1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the voltage on PVS1</span>
<span class="sd">        12-bit DAC...  -5V to 5V</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        val             Output voltage on PVS1. -5V to 5V</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="s">&#39;PVS1&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.set_pvs2"><a class="viewcode-back" href="../interface.html#interface.Interface.set_pvs2">[docs]</a>    <span class="k">def</span> <span class="nf">set_pvs2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the voltage on PVS2.</span>
<span class="sd">        12-bit DAC...  0-3.3V</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        val             Output voltage on PVS2. 0-3.3V</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="s">&#39;PVS2&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.set_pvs3"><a class="viewcode-back" href="../interface.html#interface.Interface.set_pvs3">[docs]</a>    <span class="k">def</span> <span class="nf">set_pvs3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the voltage on PVS3</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        val             Output voltage on PVS3. 0V to 3.3V</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return: Actual value set on pvs3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="s">&#39;PVS3&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Interface.set_pcs"><a class="viewcode-back" href="../interface.html#interface.Interface.set_pcs">[docs]</a>    <span class="k">def</span> <span class="nf">set_pcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set programmable current source</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        val             Output current on PCS. 0 to 3.3mA. Subject to load resistance. Read voltage on PCS to check.</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        :return: value attempted to set on pcs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAC</span><span class="o">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="s">&#39;PCS&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Interface.setOnboardLED"><a class="viewcode-back" href="../interface.html#interface.Interface.setOnboardLED">[docs]</a>    <span class="k">def</span> <span class="nf">setOnboardLED</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set shade of WS2182 LED on PIC1572 1 RA2</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        R               brightness of red colour 0-255</span>
<span class="sd">        G               brightness of green colour 0-255</span>
<span class="sd">        B               brightness of blue colour 0-255</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_ONBOARD_RGB</span><span class="p">)</span>
        <span class="c">#G=reverse_bits(G);R=reverse_bits(R);B=reverse_bits(B)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">B</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">G</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">B</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">G</span>    
</div>
<div class="viewcode-block" id="Interface.WS2812B"><a class="viewcode-back" href="../interface.html#interface.Interface.WS2812B">[docs]</a>    <span class="k">def</span> <span class="nf">WS2812B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set shade of WS2182 LED on SQR1</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        cols                2Darray [[R,G,B],[R2,G2,B2],[R3,G3,B3]...]</span>
<span class="sd">                            brightness of R,G,B ( 0-255  )</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        example::</span>
<span class="sd">        </span>
<span class="sd">            &gt;&gt;&gt; I.WS2812B([[10,0,0],[0,10,10],[10,0,10]])</span>
<span class="sd">            #sets red, cyan, magenta to three daisy chained LEDs</span>

<span class="sd">        see :ref:`rgb_video`</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_RGB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c">#R=reverse_bits(int(col[0]));G=reverse_bits(int(col[1]));B=reverse_bits(int(col[2]))</span>
            <span class="n">R</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="n">G</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="n">B</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">G</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">R</span><span class="p">);</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="Interface.fetch_buffer"><a class="viewcode-back" href="../interface.html#interface.Interface.fetch_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">starting_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">total_points</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fetches a section of the ADC hardware buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">RETRIEVE_BUFFER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">starting_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">total_points</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_points</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.clear_buffer"><a class="viewcode-back" href="../interface.html#interface.Interface.clear_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">clear_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">starting_position</span><span class="p">,</span><span class="n">total_points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clears a section of the ADC hardware buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">CLEAR_BUFFER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">starting_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">total_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.start_streaming"><a class="viewcode-back" href="../interface.html#interface.Interface.start_streaming">[docs]</a>    <span class="k">def</span> <span class="nf">start_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;CH1&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instruct the ADC to start streaming 8-bit data.  use stop_streaming to stop.</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        tg              timegap. 250KHz clock</span>
<span class="sd">        channel         channel &#39;CH1&#39;... &#39;CH9&#39;,&#39;IN1&#39;,&#39;SEN&#39;</span>
<span class="sd">        ==============  ============================================================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_streaming</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">ADC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">START_ADC_STREAMING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcCHOSA__</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span>      <span class="c">#Timegap between samples.  8MHz timer clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="o">=</span><span class="bp">True</span>
</div>
<div class="viewcode-block" id="Interface.stop_streaming"><a class="viewcode-back" href="../interface.html#interface.Interface.stop_streaming">[docs]</a>    <span class="k">def</span> <span class="nf">stop_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instruct the ADC to stop streaming data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">STOP_STREAMING</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;not streaming&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="o">=</span><span class="bp">False</span>
</div>
<div class="viewcode-block" id="Interface.sqr1"><a class="viewcode-back" href="../interface.html#interface.Interface.sqr1">[docs]</a>    <span class="k">def</span> <span class="nf">sqr1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">duty_cycle</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">echo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of sqr1</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        frequency       Frequency</span>
<span class="sd">        duty_cycle      Percentage of high time</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">256</span><span class="p">]</span>
        <span class="n">prescaler</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">prescaler</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="n">prescaler</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">wavelength</span><span class="o">&lt;</span><span class="mi">65525</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">prescaler</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">prescaler</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;out of range&#39;</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">high_time</span> <span class="o">=</span> <span class="n">wavelength</span><span class="o">*</span><span class="n">duty_cycle</span><span class="o">/</span><span class="mf">100.</span>
        <span class="k">if</span> <span class="n">echo</span><span class="p">:</span><span class="k">print</span> <span class="n">wavelength</span><span class="p">,</span><span class="n">high_time</span><span class="p">,</span><span class="n">prescaler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SQR1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">high_time</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">prescaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

        <span class="k">return</span> <span class="mf">64e6</span><span class="o">/</span><span class="n">wavelength</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="n">prescaler</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="Interface.sqr2"><a class="viewcode-back" href="../interface.html#interface.Interface.sqr2">[docs]</a>    <span class="k">def</span> <span class="nf">sqr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">duty_cycle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of sqr2</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        frequency       Frequency</span>
<span class="sd">        duty_cycle      Percentage of high time</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">256</span><span class="p">]</span>
        <span class="n">prescaler</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">prescaler</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="n">prescaler</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">wavelength</span><span class="o">&lt;</span><span class="mi">65525</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">prescaler</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">prescaler</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;out of range&#39;</span>
            <span class="k">return</span>
        <span class="n">high_time</span> <span class="o">=</span> <span class="n">wavelength</span><span class="o">*</span><span class="n">duty_cycle</span><span class="o">/</span><span class="mf">100.</span>
        <span class="k">print</span> <span class="n">wavelength</span><span class="p">,</span><span class="n">high_time</span><span class="p">,</span><span class="n">prescaler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SQR2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">high_time</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">prescaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Interface.set_sqrs"><a class="viewcode-back" href="../interface.html#interface.Interface.set_sqrs">[docs]</a>    <span class="k">def</span> <span class="nf">set_sqrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">phase</span><span class="p">,</span><span class="n">high_time1</span><span class="p">,</span><span class="n">high_time2</span><span class="p">,</span><span class="n">prescaler</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frequency of sqr1,sqr2, with phase shift</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        wavelength      Number of 64Mhz/prescaler clock cycles per wave</span>
<span class="sd">        phase           Clock cycles between rising edges of SQR1 and SQR2</span>
<span class="sd">        high time1      Clock cycles for which SQR1 must be HIGH</span>
<span class="sd">        high time2      Clock cycles for which SQR2 must be HIGH</span>
<span class="sd">        prescaler       0,1,2. Divides the 64Mhz clock by 8,64, or 256</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SQRS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">high_time1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">high_time2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">prescaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.sqr4_pulse"><a class="viewcode-back" href="../interface.html#interface.Interface.sqr4_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">sqr4_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">h3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output one set of phase correlated square pulses on SQR1,SQR2,OD1,OD2 .</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        freq            Frequency in Hertz</span>
<span class="sd">        h0              Duty Cycle for SQR1 (0-1)</span>
<span class="sd">        p1              Phase shift for SQR2 (0-1)</span>
<span class="sd">        h1              Duty Cycle for SQR2 (0-1)</span>
<span class="sd">        p2              Phase shift for OD1  (0-1)</span>
<span class="sd">        h2              Duty Cycle for OD1  (0-1)</span>
<span class="sd">        p3              Phase shift for OD2  (0-1)</span>
<span class="sd">        h3              Duty Cycle for OD2  (0-1)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">params</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0xFFFF00</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;frequency too low.&#39;</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0x3FFFC0</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">3</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0x7FFF8</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">2</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0xFFFF</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SQR4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">wavelength</span><span class="o">*</span><span class="n">h0</span><span class="p">))</span>

        <span class="n">A1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p1</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h1</span><span class="o">+</span><span class="n">p1</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p2</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h2</span><span class="o">+</span><span class="n">p2</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">A3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p3</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h3</span><span class="o">+</span><span class="n">p3</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>

        <span class="c">#print p1,h1,p2,h2,p3,h3</span>
        <span class="c">#print wavelength,int(wavelength*h0),A1,B1,A2,B2,A3,B3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.sqr4_continuous"><a class="viewcode-back" href="../interface.html#interface.Interface.sqr4_continuous">[docs]</a>    <span class="k">def</span> <span class="nf">sqr4_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">h3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize continuously running phase correlated square waves on SQR1,SQR2,OD1,OD2</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        freq            Frequency in Hertz</span>
<span class="sd">        h0              Duty Cycle for SQR1 (0-1)</span>
<span class="sd">        p1              Phase shift for SQR2 (0-1)</span>
<span class="sd">        h1              Duty Cycle for SQR2 (0-1)</span>
<span class="sd">        p2              Phase shift for OD1  (0-1)</span>
<span class="sd">        h2              Duty Cycle for OD1  (0-1)</span>
<span class="sd">        p3              Phase shift for OD2  (0-1)</span>
<span class="sd">        h3              Duty Cycle for OD2  (0-1)</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">params</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0xFFFF00</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;frequency too low.&#39;</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0x3FFFC0</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">3</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0x7FFF8</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">2</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wavelength</span><span class="o">&gt;</span><span class="mh">0xFFFF</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">64e6</span><span class="o">/</span><span class="n">freq</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">params</span><span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SQR4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">wavelength</span><span class="o">*</span><span class="n">h0</span><span class="p">))</span>

        <span class="n">A1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p1</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h1</span><span class="o">+</span><span class="n">p1</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p2</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h2</span><span class="o">+</span><span class="n">p2</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">A3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p3</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">B3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">h3</span><span class="o">+</span><span class="n">p3</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="n">wavelength</span><span class="p">)</span>

        <span class="c">#print p1,h1,p2,h2,p3,h3</span>
        <span class="c">#print wavelength,int(wavelength*h0),A1,B1,A2,B2,A3,B3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">A3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">B3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="Interface.map_reference_clock"><a class="viewcode-back" href="../interface.html#interface.Interface.map_reference_clock">[docs]</a>    <span class="k">def</span> <span class="nf">map_reference_clock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaler</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map the internal oscillator output  to SQR1,SQR2,SQR3,SQR4 or WAVEGEN</span>
<span class="sd">        The output frequency is 128/(1&lt;&lt;scaler) MHz</span>
<span class="sd">        </span>
<span class="sd">        scaler [0-15]</span>
<span class="sd">            </span>
<span class="sd">            * 0 -&gt; 128MHz</span>
<span class="sd">            * 1 -&gt; 64MHz</span>
<span class="sd">            * 2 -&gt; 32MHz</span>
<span class="sd">            * 3 -&gt; 16MHz</span>
<span class="sd">            * .</span>
<span class="sd">            * .</span>
<span class="sd">            * 15 -&gt;128./32768 MHz</span>

<span class="sd">        example::</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; I.map_reference_clock(2,&#39;SQR1&#39;,&#39;SQR2&#39;)</span>
<span class="sd">        </span>
<span class="sd">        outputs 32 MHz on SQR1, SQR2 pins</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            if you change the reference clock for &#39;wavegen&#39; , the waveform generator resolution and range will also change.</span>
<span class="sd">            default frequency for &#39;wavegen&#39; is 16MHz. Setting to 1MHz will give you 16 times better resolution, but a usable range of</span>
<span class="sd">            0Hz to about 100KHz instead of the original 2MHz.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">MAP_REFERENCE</span><span class="p">)</span>
        <span class="n">chan</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="s">&#39;SQR1&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span><span class="n">chan</span><span class="o">|=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="s">&#39;SQR2&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span><span class="n">chan</span><span class="o">|=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="s">&#39;SQR3&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span><span class="n">chan</span><span class="o">|=</span><span class="mi">4</span>
        <span class="k">if</span> <span class="s">&#39;SQR4&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span><span class="n">chan</span><span class="o">|=</span><span class="mi">8</span>
        <span class="k">if</span> <span class="s">&#39;WAVEGEN&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span><span class="n">chan</span><span class="o">|=</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">chan</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;WAVEGEN&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DDS_CLOCK</span> <span class="o">=</span> <span class="mf">128e6</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Interface.read_program_address"><a class="viewcode-back" href="../interface.html#interface.Interface.read_program_address">[docs]</a>    <span class="k">def</span> <span class="nf">read_program_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and returns the value stored at the specified address in program memory</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        address         Address to read from. Refer to PIC24EP64GP204 programming manual</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">READ_PROGRAM_ADDRESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">address</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">((</span><span class="n">address</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v</span>
        </div>
    <span class="k">def</span> <span class="nf">__write_program_address__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a value to the specified address in program memory. Disabled in firmware.</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        address         Address to write to. Refer to PIC24EP64GP204 programming manual</span>
<span class="sd">                        Do Not Screw around with this. It won&#39;t work anyway.            </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WRITE_PROGRAM_ADDRESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">address</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">((</span><span class="n">address</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

<div class="viewcode-block" id="Interface.read_data_address"><a class="viewcode-back" href="../interface.html#interface.Interface.read_data_address">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and returns the value stored at the specified address in RAM</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        address         Address to read from.  Refer to PIC24EP64GP204 programming manual|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">READ_DATA_ADDRESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">address</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">v</span>
        </div>
<div class="viewcode-block" id="Interface.write_data_address"><a class="viewcode-back" href="../interface.html#interface.Interface.write_data_address">[docs]</a>    <span class="k">def</span> <span class="nf">write_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a value to the specified address in RAM</span>

<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        address         Address to write to.  Refer to PIC24EP64GP204 programming manual|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WRITE_DATA_ADDRESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">address</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Interface.servo"><a class="viewcode-back" href="../interface.html#interface.Interface.servo">[docs]</a>    <span class="k">def</span> <span class="nf">servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chan</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Output A PWM waveform on SQR1/SQR2 corresponding to the angle specified in the arguments.</span>
<span class="sd">        This is used to operate servo motors.  Tested with 9G SG-90 Servo motor.</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        chan            1 or 2. Whether to use SQ1 or SQ2 to output the PWM waveform used by the servo </span>
<span class="sd">        angle           0-180. Angle corresponding to which the PWM waveform is generated.</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chan</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SQR1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SET_SQR2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="mi">1900</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

</div>
    <span class="k">def</span> <span class="nf">__stepperMotor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">steps</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">direction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">NONSTANDARD_IO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">STEPPER_MOTOR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">((</span><span class="n">steps</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">steps</span><span class="o">*</span><span class="n">delay</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">)</span> <span class="c">#convert mS to S</span>

<div class="viewcode-block" id="Interface.stepForward"><a class="viewcode-back" href="../interface.html#interface.Interface.stepForward">[docs]</a>    <span class="k">def</span> <span class="nf">stepForward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">steps</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control stepper motors using SQR1-4</span>
<span class="sd">        </span>
<span class="sd">        take a fixed number of steps in the forward direction with a certain delay( in milliseconds ) between each step.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stepperMotor__</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.stepBackward"><a class="viewcode-back" href="../interface.html#interface.Interface.stepBackward">[docs]</a>    <span class="k">def</span> <span class="nf">stepBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">steps</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control stepper motors using SQR1-4</span>
<span class="sd">        </span>
<span class="sd">        take a fixed number of steps in the backward direction with a certain delay( in milliseconds ) between each step.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stepperMotor__</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Interface.servo4"><a class="viewcode-back" href="../interface.html#interface.Interface.servo4">[docs]</a>    <span class="k">def</span> <span class="nf">servo4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Operate Four servo motors independently using SQR1, SQR2, SQR3, SQR4.</span>
<span class="sd">        tested with SG-90 9G servos.</span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        a1              Angle to set on Servo which uses SQR1 as PWM input. [0-180]</span>
<span class="sd">        a2              Angle to set on Servo which uses SQR2 as PWM input. [0-180]</span>
<span class="sd">        a3              Angle to set on Servo which uses SQR3 as PWM input. [0-180]</span>
<span class="sd">        a4              Angle to set on Servo which uses SQR4 as PWM input. [0-180]</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="mi">2</span>       <span class="c">#continuous waveform.  prescaler 2( 1:64)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">WAVEGEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">SQR4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>       <span class="c">#10mS wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">750</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="mi">1900</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">750</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="mi">1900</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">750</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">a3</span><span class="o">*</span><span class="mi">1900</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="mi">750</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">a4</span><span class="o">*</span><span class="mi">1900</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Interface.enableUartPassthrough"><a class="viewcode-back" href="../interface.html#interface.Interface.enableUartPassthrough">[docs]</a>    <span class="k">def</span> <span class="nf">enableUartPassthrough</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">baudrate</span><span class="p">,</span><span class="n">persist</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        All data received by the device is relayed to an external port(SCL[TX],SDA[RX]) after this function is called</span>
<span class="sd">        </span>
<span class="sd">        If a period &gt; .5 seconds elapses between two transmit/receive events, the device resets</span>
<span class="sd">        and resumes normal mode. This timeout feature has been implemented in lieu of a hard reset option.</span>
<span class="sd">        can be used to load programs into secondary microcontrollers with bootloaders such ATMEGA, and ESP8266</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        .. tabularcolumns:: |p{3cm}|p{11cm}|</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        **Arguments** </span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        baudrate        BAUDRATE to use</span>
<span class="sd">        persist         If set to True, the device will stay in passthrough mode until the next power cycle.</span>
<span class="sd">                        Otherwise(default scenario), the device will return to normal operation if no data is sent/</span>
<span class="sd">                        received for a period greater than one second at a time.</span>
<span class="sd">        ==============  ============================================================================================</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">PASSTHROUGHS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">PASS_UART</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">persist</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(((</span><span class="mf">64e6</span><span class="o">/</span><span class="n">baudrate</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">print</span> <span class="s">&#39;BRGVAL:&#39;</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(((</span><span class="mf">64e6</span><span class="o">/</span><span class="n">baudrate</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;junk bytes read:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="Interface.estimateDistance"><a class="viewcode-back" href="../interface.html#interface.Interface.estimateDistance">[docs]</a>    <span class="k">def</span> <span class="nf">estimateDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        Read data from ultrasonic distance sensor HC-SR04/HC-SR05.  Sensors must have separate trigger and output pins.</span>
<span class="sd">        First a 10uS pulse is output on SQR3.  SQR3 must be connected to the TRIG pin on the sensor prior to use.</span>

<span class="sd">        Upon receiving this pulse, the sensor emits a sequence of sound pulses, and the logic level of its output</span>
<span class="sd">        pin(which we will monitor via ID1) is also set high.  The logic level goes LOW when the sound packet</span>
<span class="sd">        returns to the sensor, or when a timeout occurs.</span>

<span class="sd">        The ultrasound sensor outputs a series of 8 sound pulses at 40KHz which corresponds to a time period</span>
<span class="sd">        of 25uS per pulse. These pulses reflect off of the nearest object in front of the sensor, and return to it.</span>
<span class="sd">        The time between sending and receiving of the pulse packet is used to estimate the distance.</span>
<span class="sd">        If the reflecting object is either too far away or absorbs sound, less than 8 pulses may be received, and this</span>
<span class="sd">        can cause a measurement error of 25uS which corresponds to 8mm.</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">NONSTANDARD_IO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">HCSR04_HEADER</span><span class="p">)</span>

        <span class="n">timeout_msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">64e6</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">timeout_msb</span><span class="p">)</span>

        <span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getLong__</span><span class="p">()</span>
        <span class="n">tmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__getInt__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="c">#print A,B</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmt</span> <span class="o">&gt;=</span> <span class="n">timeout_msb</span> <span class="ow">or</span> <span class="n">B</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span><span class="k">return</span> <span class="mi">0</span>
        <span class="n">rtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">/</span><span class="mf">64e6</span>
        <span class="k">return</span> <span class="n">rtime</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Interface.TemperatureAndHumidity"><a class="viewcode-back" href="../interface.html#interface.Interface.TemperatureAndHumidity">[docs]</a>    <span class="k">def</span> <span class="nf">TemperatureAndHumidity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        init  AM2302.  </span>
<span class="sd">        This effort was a waste.  There are better humidity and temperature sensors available which use well documented I2C</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">NONSTANDARD_IO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">AM2302_HEADER</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_channels_in_buffer</span><span class="o">=</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Interface.opticalArray"><a class="viewcode-back" href="../interface.html#interface.Interface.opticalArray">[docs]</a>    <span class="k">def</span> <span class="nf">opticalArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tg</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">tp</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        read from 3648 element optical sensor array TCD3648P from Toshiba</span>

<span class="sd">        see :ref:`tcd_video`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">samples</span><span class="o">=</span><span class="mi">3694</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">NONSTANDARD_IO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">TCD1304_HEADER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__calcCHOSA__</span><span class="p">(</span><span class="s">&#39;CH5&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendInt__</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_gain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">achans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s">&#39;CH5&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">timebase</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">TWELVE_BIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">=</span><span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_in_buffer</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Interface.readLog"><a class="viewcode-back" href="../interface.html#interface.Interface.readLog">[docs]</a>    <span class="k">def</span> <span class="nf">readLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        read hardware debug log. </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__sendByte__</span><span class="p">(</span><span class="n">READ_LOG</span><span class="p">)</span>
        <span class="n">log</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">__get_ack__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">log</span>
</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;&quot;&quot;this is not an executable file</span>
<span class="s">    from v0 import interface</span>
<span class="s">    I=interface.connect()</span>
<span class="s">    </span>
<span class="s">    You&#39;re good to go.</span>
<span class="s">    </span>
<span class="s">    eg.</span>
<span class="s">    </span>
<span class="s">    I.get_average_voltage(&#39;CH1&#39;)</span>
<span class="s">    &quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">vLabtool Quick ref</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Jithin B..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>